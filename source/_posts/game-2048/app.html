<!DOCTYPE html>
<html lang="en">

<head>
    <title></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!--<link href="css/style.css" rel="stylesheet">-->
    <style>
        body {
            font-size: 14px;
        }
        
        #panel {
            width: 100%;
            max-width: 500px;
            height: 100%;
            max-height: 500px;
            background-color: #efefef;
            border: 1px solid #333;
            border-radius: 5px;
            position: absolute;
            margin: 10px;
        }
        
        #panel .cell {
            width: 100px;
            height: 100px;
            margin: 10px;
            background-color: #666;
            border: 1px solid #999;
            border-radius: 5px;
            position: absolute;
            text-align: center;
            line-height: 100px;
        }
    </style>
</head>

<body>
    <div id="container">
        <header>
            <h2>2048</h2>
            <h3>SCORE:<span id="score">0</span></h3>
            <button type="button">NEW GAME</button>
        </header>
        <div id="panel">
            <div class="cell" id="c-0-0"></div>
            <div class="cell" id="c-0-1"></div>
            <div class="cell" id="c-0-2"></div>
            <div class="cell" id="c-0-3"></div>
            <div class="cell" id="c-1-0"></div>
            <div class="cell" id="c-1-1"></div>
            <div class="cell" id="c-1-2"></div>
            <div class="cell" id="c-1-3"></div>
            <div class="cell" id="c-2-0"></div>
            <div class="cell" id="c-2-1"></div>
            <div class="cell" id="c-2-2"></div>
            <div class="cell" id="c-2-3"></div>
            <div class="cell" id="c-3-0"></div>
            <div class="cell" id="c-3-1"></div>
            <div class="cell" id="c-3-2"></div>
            <div class="cell" id="c-3-3"></div>
        </div>
        <div id="msg"></div>
    </div>
    <script src="http://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/jquery.touchswipe/1.6.18/jquery.touchSwipe.js"></script>
    <script>
        var lock = false;
        var cell_grid = [
            [0, 0, 0, 0],
            [0, 0, 0, 0],
            [0, 0, 0, 0],
            [0, 0, 0, 0]
        ];

        var game_score = 0;

        var color_cell = [];
        color_cell[2] = "#eee4da";
        color_cell[4] = "#ede0c8";
        color_cell[8] = "#f2b179";
        color_cell[16] = "#f59563";
        color_cell[32] = "#f67c5f";
        color_cell[64] = "#f65e3b";
        color_cell[128] = "#edcf72";
        color_cell[256] = "#edcc61";
        color_cell[512] = "#9c0";
        color_cell[1024] = "#33b5e5";
        color_cell[2048] = "#09c";
        color_cell[4096] = "#a6c";
        color_cell[8192] = "#93c";

        var font_cell = [];
        font_cell[2] = "25px";
        font_cell[4] = "25px";
        font_cell[8] = "23px";
        font_cell[16] = "21px";
        font_cell[32] = "21px";
        font_cell[64] = "21px";
        font_cell[128] = "18px";
        font_cell[256] = "18px";
        font_cell[512] = "18px";
        font_cell[1024] = "15px";
        font_cell[2048] = "15px";
        font_cell[4096] = "15px";
        font_cell[8192] = "15px";

        function getLeftPos(i, j) {
            return 10 + 60 * j;
        }

        function getTopPos(i, j) {
            return 10 + 60 * i;
        }

        function init() { //  grid
            var cell, num;
            for (var i = 0; i <= 3; ++i) {
                for (var j = 0; j <= 3; ++j) {
                    cell = $('#c-' + i + '-' + j);
                    num = $('<span id="number-cell-' + i + '-' + j + '"></span>');
                    cell.css({
                        'left': 10 + 120 * j,
                        'top': 10 + 120 * i
                    }).append(num);
                }
            }
        }

        function creat_2num() {
            var i = Math.floor(Math.random() * 4);
            var j = Math.floor(Math.random() * 4);
            var n = Math.floor(Math.random() * 4);
            var m = Math.floor(Math.random() * 4);

            while (cell_grid[i][j] != 0 || cell_grid[n][m] != 0);

            var number1 = Math.random() > 0.5 ? 4 : 2;
            var number2 = Math.random() > 0.5 ? 4 : 2;

            cell_grid[i][j] = number1;
            cell_grid[n][m] = number2;
        }

        function can_left() {
            for (var i = 0; i <= 3; i++) {
                for (var j = 1; j <= 3; j++) {
                    if (cell_grid[i][j] != 0) {
                        if (cell_grid[i][j - 1] == 0 || cell_grid[i][j - 1] == cell_grid[i][j]) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }

        function handle_left() {
            for (var i = 0; i <= 3; i++) {
                for (var j = 1; j <= 3; j++) {
                    if (cell_grid[i][j] != 0) {
                        for (var k = 0; k < j; k++) {
                            if (cell_grid[i][k] == 0 && has_road(i, k, i, j)) {
                                cell_grid[i][k] = cell_grid[i][j];
                                cell_grid[i][j] = 0;
                                player_run_view(i, j, i, k);
                                break;
                            } else if (cell_grid[i][k] == cell_grid[i][j] && has_road(i, k, i, j)) {
                                game_score += cell_grid[i][j];
                                $("#score").text(game_score);
                                cell_grid[i][k] += cell_grid[i][j];
                                cell_grid[i][j] = 0;
                                player_run_view(i, j, i, k);
                                break;
                            }
                        }
                    }
                }
            }
        }

        function player_set_number_view(i, j, number) {
            var cell = $("#number-cell-" + i + "-" + j);
            cell.text(number);
            cell.css("background-color", color_cell[number]);
            cell.css("font-size", font_cell[number]);
            cell.animate({
                left: getLeftPos(i, j),
                top: getTopPos(i, j),
                width: 50,
                height: 50
            }, 150);
        }

        function player_run_view(i, j, i, k) {
            var cell = $("#number-cell-" + i + "-" + j);
            cell.animate({
                left: getLeftPos(i, k),
                top: getTopPos(i, k)
            }, 180);
        }

        function player_run_vertical_view(i, j, k, j) {
            var cell = $("#number-cell-" + i + "-" + j);
            cell.animate({
                left: getLeftPos(k, j),
                top: getTopPos(k, j)
            }, 180);
        }

        $("#panel").swipe({
            swipe: function(event, direction, distance, duration, fingerCount) {
                var can_handler = false;
                switch (direction) {
                    case 'left': //left
                        console.log('left');
                        if (can_left()) {
                            handle_left();
                        }
                        break;
                    case 'up': //up
                        console.log('up');
                        break;
                    case 'right': //right
                        console.log('right');
                        break;
                    case 'down': //down
                        console.log('down');
                        break;
                    default:
                }
            }
        });

        /////////////////////
        init();
        creat_2num();
    </script>
</body>

</html>