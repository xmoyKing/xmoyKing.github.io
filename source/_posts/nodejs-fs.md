---
title: Nodejs-文件系统
categories:
  - Nodejs
tags:
  - nodejs
  - fs
date: 2016-09-28 10:32:45
updated: 2016-09-28 10:32:45
---

参考自:[Node.js 文档](http://nodejs.cn/api/fs)

Nodejs提供的fs模块几乎都有两个版本，一个同步版本，一个异步版本，比如异步的write()和同步的writeSync(), 虽然这两个方法在底层功能上是一致的，但这两个版本在运用时有比较大的区别，最好不要混用。

异步和同步调用的区别：
- 异步调用需要回调函数做为参数，回调函数在文件系统的请求完成时被调用，并通过第一个参数为错误对象
- 异步调用自动处理异常，若发生异常，就将错误对象作为第一个参数传递，否则第一个参数为null。而同步调用中处理异常需要try/catch语句
- 同步调用立即运行，且直到结束前会阻塞主线程。异步调用则被放在事件队列中，且执行后返回主线程（真正的执行其实是在事件循环中被提取出时才执行）

大多数语言的文件系统打开文件都提供了好几种读写模式，在node中也是这样：
```js
// 异步打开一个文件，需要指定回调函数
fs.open(path, flags, [mode], callback);
// 同步打开一个文件
fs.openSync(path, flags, [mode]);
```

### 这里的flags即指定读写模式

'r' - 以读取模式打开文件。如果文件不存在则发生异常。

'r+' - 以读写模式打开文件。如果文件不存在则发生异常。

'rs+' - 以同步读写模式打开文件。命令操作系统绕过本地文件系统缓存。

这对 NFS 挂载模式下打开文件很有用，因为它可以让你跳过潜在的旧本地缓存。 它对 I/O 的性能有明显的影响，所以除非需要，否则不要使用此标志。

注意，这不会使 fs.open() 进入同步阻塞调用。 如果那是你想要的，则应该使用 fs.openSync()。

'w' - 以写入模式打开文件。文件会被创建（如果文件不存在）或截断（如果文件存在）。

'wx' - 类似 'w'，但如果 path 存在，则失败。

'w+' - 以读写模式打开文件。文件会被创建（如果文件不存在）或截断（如果文件存在）。

'wx+' - 类似 'w+'，但如果 path 存在，则失败。

'a' - 以追加模式打开文件。如果文件不存在，则会被创建。

'ax' - 类似于 'a'，但如果 path 存在，则失败。

'a+' - 以读取和追加模式打开文件。如果文件不存在，则会被创建。

'ax+' - 类似于 'a+'，但如果 path 存在，则失败。

mode选项只有在创建文件的时候才有效，默认为0666，表示可读写，类似linux的文件系统权限模式。