---
title: 指尖上行，移动前端开发进阶之路笔记-5
categories: WebApp
tags:
  - webapp
  - page-performance-optimization
date: 2018-01-16 15:33:33
updated: 2018-01-16 15:33:33
---

### 页面性能优化
#### 优化原理
一个网站即使内容丰富，界面美观，但若打开速度慢或显示慢，那么就很难给用户留下好印象，无法留下用户。

随着互联网的发展，内容越来越多，对带宽、服务器及用户设备的要求越来越高，过多的代码不仅影响服务器、带宽、用户访问的成本，更会影响用户体验。

优化思路：
**全局观优化**
在一般的情况下，开发者只要把本分工作做好就行，但这种认识是不够的，同样的事情用不一样的眼光去看待就会不一样，那么优化，用不一样的方式结果也不会一样，用不同角色去看待也不会一样。

优化的不仅仅是代码，代码只是其中一部分，更多的是在于对项目全局的把控，从前期分析、创意、后期制作、上线准备即服务器压力等都要充分考虑，前期的优化可以帮助后期制作、上线准备提供良好基础。

**四两拨千斤**
在不改变程序运行效果的前提下，对被编译的程序进行等价变换，用最少的代码、资源（CPU、内存）等使之能生成更高效的目标代码、实现更多功能，因为更多的代码可能意味着更多的缺陷。

编写代码前需要厘清需求功能，避免一些重复功能或重复代码。

**主次分明**
精简或弱化次要的功能，突出或加强主要功能。

若在优化工作开始的时候，还尚未明确优化内容和目的，那么就很容易陷入误区，所以，在一开始，就应该清楚了解要达到的效果，明确那些功能（板块）是主要的、那些是次要的，集中精力优化主要功能的各种问题。

**重用**
在实际的开发中，经常有各种变数，可能一开始只要优化一部分，后来可能发现又需要优化另一部分，在这种情况下，需要清晰了解需求，那些功能可能会经常修改或扩展，尽量把这些功能模版化和易扩展。

封装、抽象、重用都只是过渡，从工程角度来看最终目标都是加强代码可读性、可维护性及可扩展性。

#### 资源优化
##### 图像
根据HTTP Archieve的统计数据显示，在Web页面中，图片内容已经占到了互联网内容总量的62%，在移动端比例更高。如今全球网站的平均页面大小超过1MB，对于移动端来说，这个大小不仅会让用户在移动终端设备上浏览网页的时候速度变慢，而且会让用户付出的流量增加，图像优化的效果，对于整个页面和站点的流量优化将起到关键性作用。

**减少使用图像**
网页图片内容占比很大，若能减少这部分的比例，那么将会大大降低页面的内容，减少用户的流量成本。

在移动端设备上都能较好的支持H5和CSS3的一些属性，很多以前需要用图片来实现的效果（阴影、渐变、圆角）都可以直接用纯HTML、CSS或SVG来实现，实现只需要用短短的十几行代码、用几个字节就可以完成图片需要几十kb甚至上百kb才能实现的界面效果。甚至从某种角度来看，直接用CSS渲染的画面，比导出的jpg图像质量更高，在遇到缩放的时候显示的效果更好。

除了使用CSS和SVG实现之外，遇到一些icon的时候，也可以使用网络字体来实现，iconfont字体文件一般较小，嵌入页面使用也很方便，比起直接使用图片的方案，实在方便了很多。

**图像格式的选择**
在确定无法使用其他手段代替图片之后，使用图片前需要选择合适的图片格式，目前移动端主流图片格式如下表：

| 格式 | 压缩方式 | 透明度 | 动画 | 应用范围 |
| - | - | - | - | - |
| JPEG | 有损 | 不支持 | 不支持 | 复杂的图形 |
| GIF | 无损 | 支持索引色透明 | 支持 | 简单的颜色和动画 |
| PNG | 无损 | 支持索引色透明和alpha透明 | 不支持 | 较复杂的颜色、图形 |
| SVG | 无损 | 支持 | 支持 | 矢量图形 |

JPEG格式分为baseline-jpeg和preogressive-jpeg两种：
- baseline使用从上到下的扫描方式存储，在打开这类图像的时候，图形数据按存储的顺序从上到下显示，知道数据读完，就完成了图片的显示，所以若遇到文件较大或网络不佳，就会看到图片一行一行的加载。
- preogressive使用多次扫描的方式存储，在打开图片是，会先显示图片的模糊轮廓，然后在进行下一次扫描，没扫描一次图像就更清晰一些，知道数据全部读完，这种格式的有点是在网络不佳的情况下，可以先看到图片轮廓，减少用户等待时间，在移动端尤其使用，所以在JPEG格式上，优先后者。

GIF分为GIF静态图片和GIF动画，压缩率高，但最多只支持256色。

PNG格式分为PNG8、PNG24、PNG32：
- PNG8可支持索引色透明即alpha通道半透明，但最大也只支持256色，文件小；