---
title: angularjs巩固实践-33-依赖注入
categories:
  - fe
tags:
  - fe
  - angularjs
date: 2017-08-04 17:25:26
updated:
---

依赖注入（Dependency Injection）简称DI, 简单理解一下什么是DI。

当写程序时需要某个对象（完成某种任务），有如下几种方式来获取这个对象：
1. 每次都手动创建
  这个是最简单直接的方式，但由于对象创建可能很复杂，比如需要很多参数初始化，甚至它依赖很多其他对象，所以这种自己创建的方式可能并不是非常好，无法适应复杂的对象，同时随着对象的复杂化，难度成倍提升。
  总之，自己动手丰衣足食是一个很难实现的理想。
2. 从全局中查找并获取
  这种方式也很容易想到，不用每次都创建，而是最开始创建一个全局对象，然后用到时到全局对象中查找即可，`obj = globalRegisterObj.get(objId)`这种方式不用管它的初始化，拿来就用，非常nice。
  但，仍然是有问题的，比如它很难被单元测试，全局变量是单元测试中的魔鬼，因为它让各个“单元”相互耦合。
3. DI —— 衣来伸手饭来张口
  所谓的DI, 就是直接指定所需对象，然后在使用时即有人将这些对象给出。这个“人”可能就是“框架（Framework）”，也可能是“测试容器（Test Runner）”，使用者不需要关心这个“人”是谁，也不需要关心这个“人”是如何将所需对象给出的。这个“人”的专业叫法为“容器”。
  “指定所需对象”的方式也有多种，比如直接声明一个属性，或者写一个注解（annotation），或者用配置文件声明依赖关系，或者在函数参数中声明。ng所采用的方式是函数参数，以及特殊的annotation来防止代码压缩破坏参数名（在使用js代码压缩工具时，一般会将函数参数名替换掉，但是这会破坏ng的DI声明）。

#### 如何用js实现DI
在js中实现DI，看似很难，其他原理很简单，关键是函数对象的toString()方法。在js中，对一个函数对象执行toString(),返回值是函数的源码，拿到源码后就可以对函数的声明进行解析了。