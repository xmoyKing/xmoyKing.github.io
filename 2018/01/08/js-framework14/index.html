<!DOCTYPE html>
<html style="display: none;" lang="en">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.0 -->
    <script>
        window.materialVersion = "1.5.0"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">

    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source"/>














    <!-- Title -->
    
    <title>
        
            JavaScript框架设计笔记-14-动画引擎-2 | 
        
        KING · NOTE
    </title>

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="KING">
    <meta name="description" itemprop="description" content="Loneliness is the carnival of one single soul.">
    <meta name="keywords" content=",js,js-framework,css3 animation,requestAnimationFrame,transition">

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(window.oldVersion){var remove=window.oldVersion.reduce(function(p,c){return p||data.indexOf("/*"+c+"*/")!==-1},false);if(remove){lsloader.removeLS(key)}}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload,isJs){if(typeof cssonload==="boolean"){isJs=cssonload;cssonload=undefined}isJs=isJs||false;cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}code=code.split(versionString)[1];if(isJs){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload,isJs)}};lsloader.requestResource=function(name,path,cssonload,isJs){var that=this;if(isJs){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else{this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="KING · NOTE">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/css/material.min.css",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/css/style.min.css",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->
<!-- add By KING 2017.11.16 -->
<link rel="stylesheet" href="/css/highlightjs/vs.css">
<style>
  #scheme-Paradox .material-layout .highlight .meta{
    display: initial;
    padding: initial;
  }
</style>


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icon -->

    <style>
        @font-face {
            font-family: 'Material Icons';
            font-style: normal;
            font-weight: 400;
            src: local('Material Icons'),
            local('MaterialIcons-Regular'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.woff2) format('woff2'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.woff) format('woff'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.ttf) format('truetype');
        }
    </style>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/jquery.min.js", true)</script>
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="https://github.com/xmoyKING">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="JavaScript框架设计笔记-14-动画引擎-2 | KING · NOTE">
    <meta property="og:image" content="https://github.com/xmoyKING/img/favicon.png" />
    <meta property="og:description" content="Loneliness is the carnival of one single soul.">
    <meta property="og:article:tag" content="js"> <meta property="og:article:tag" content="js-framework"> <meta property="og:article:tag" content="css3 animation"> <meta property="og:article:tag" content="requestAnimationFrame"> <meta property="og:article:tag" content="transition"> 

    
        <meta property="article:published_time" content="Mon Jan 08 2018 18:27:46 GMT+0800" />
        <meta property="article:modified_time" content="Mon Jan 08 2018 18:27:46 GMT+0800" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="JavaScript框架设计笔记-14-动画引擎-2 | KING · NOTE">
    <meta name="twitter:description" content="Loneliness is the carnival of one single soul.">
    <meta name="twitter:image" content="https://github.com/xmoyKING/img/favicon.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://github.com/xmoyKING" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="https://github.com/xmoyKING/2018/01/08/js-framework14/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "https://github.com/xmoyKING/2018/01/08/js-framework14/index.html",
    "headline": "JavaScript框架设计笔记-14-动画引擎-2",
    "datePublished": "Mon Jan 08 2018 18:27:46 GMT+0800",
    "dateModified": "Mon Jan 08 2018 18:27:46 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "KING",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": "Loneliness is the carnival of one single soul."
    },
    "publisher": {
        "@type": "Organization",
        "name": "KING · NOTE",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",js,js-framework,css3 animation,requestAnimationFrame,transition",
    "description": "Loneliness is the carnival of one single soul.",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#requestAnimationFrame"><span class="post-toc-number">1.</span> <span class="post-toc-text">requestAnimationFrame</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#CSS-transition"><span class="post-toc-number">2.</span> <span class="post-toc-text">CSS transition</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#CSS3-animation"><span class="post-toc-number">3.</span> <span class="post-toc-text">CSS3 animation</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#mass-Framework基于CSS3的动画引擎"><span class="post-toc-number">4.</span> <span class="post-toc-text">mass Framework基于CSS3的动画引擎</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                JavaScript框架设计笔记-14-动画引擎-2
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>KING</strong>
        <span>Jan 08, 2018</span>
        <!-- Updated Time , add By KING 2017.11.16 -->
        <span>Jan 08, 2018 UPDATED</span> 
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/css3-animation/">css3 animation</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/js/">js</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/js-framework/">js-framework</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/requestAnimationFrame/">requestAnimationFrame</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/transition/">transition</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=JavaScript框架设计笔记-14-动画引擎-2&url=https://github.com/xmoyKING/2018/01/08/js-framework14/index.html&pic=https://github.com/xmoyKING/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                Share to Weibo
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=JavaScript框架设计笔记-14-动画引擎-2&url=https://github.com/xmoyKING/2018/01/08/js-framework14/index.html&via=KING" target="_blank">
            <li class="mdl-menu__item">
                Share to Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://github.com/xmoyKING/2018/01/08/js-framework14/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=https://github.com/xmoyKING/2018/01/08/js-framework14/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h4 id="requestAnimationFrame"><a href="#requestAnimationFrame" class="headerlink" title="requestAnimationFrame"></a>requestAnimationFrame</h4><p>若页面允许了很多定时器，那么无论怎么优化，定时器越多，延时就越严重，最后肯定是超过指定时间才能完成动画。因此YUI、kissy、mass等采用中央队列的方式，将定时器设置为1个。</p>
<p>而浏览器早就有这样的想法了，早期的requestAnimationFrame就是这样来的，比如webkitRequestAnimationFrame, 其用法同定时器，第一个是回调，第二个可选，传入执行动画的元素节点进去，返回一个ID，允许像clearTimeout那样终止函数，对应的取消方法为webkitCancelRequestAnimationFrame用于终止动画，也就是后来的webkitCancelAnimationFrame。</p>
<p>而requestAnimationFrame并不是没有缺点的，它不能控制fps，比如一些慢放动作，而在一些需要高帧数的动态场景中，若帧数不够高则画面会发虚或模糊，利用原生setTimeout方法(现代浏览器下最短间隔为4ms，换而言之理论最高帧数达250帧)，能让画面更清晰。</p>
<p>实际开发中，尤其是游戏中，结合多种异步API是非常有必要的，比如作为背景的树木、流水、NPC可以用requestAnimationFrame实现，而玩家角色，由于需要点击、配合速度、体力、耐力等元素，走路速度需要可变，那么用setTimeout比较呼喝，而一些高帧动画，则需要postMessage、Image.onerror、setImmediate、MessageChannel等API了。</p>
<h4 id="CSS-transition"><a href="#CSS-transition" class="headerlink" title="CSS transition"></a>CSS transition</h4><p>transition是CSS3的重要模块，是CSS动画的常用方式，W3C标准中对其的描述是：<br>CSS的transition允许CSS的属性值在一定的时间区间内平滑地过渡，该效果可以在鼠标单击、获得焦点、被点击或对元素任何改变中触发，并圆滑的以动画效果改变CSS的属性值。</p>
<p>transition主要包括四个属性值：</p>
<ul>
<li>transition-property，样式名</li>
<li>transition-duration，持续时间</li>
<li>transition-timing-function，缓动公式</li>
<li>transition-delay，延迟触发时间</li>
</ul>
<p><strong>transition-property</strong><br>指定当元素其中一个属性改变时执行transition效果，有以下几个值：</p>
<ul>
<li>none，没有属性改变，当值为none时，transition会立即停止执行</li>
<li>all，所有属性改变，默认值，元素产生的任何属性值变化都将执行transition效果</li>
<li>property-name，元素属性名，<ul>
<li>颜色相关：background-color、border-color、outline-color、color</li>
<li>大小、宽高、字体大小、间距、行高相关：word-spacing、width、vertical-align、top、padding、margin、min-width、line-height、border-width、border-spacing、backgound-positon</li>
<li>透明度，opicity</li>
<li>变形相关，transform</li>
<li>阴影，text-shadow、box-shadow</li>
<li>线性渐变与径向渐变，gradient、linear-gradient</li>
</ul>
</li>
</ul>
<p><strong>transition-duration</strong><br>动画持续时间，单位s、ms，可以连续写多个持续时间，对应多个不同的样式变换：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">transition-duration</span>: 6<span class="selector-tag">s</span></span><br><span class="line"><span class="selector-tag">transition-duration</span>: 120<span class="selector-tag">ms</span></span><br><span class="line"><span class="selector-tag">transition-duration</span>: 1<span class="selector-tag">s</span>, 2<span class="selector-tag">s</span></span><br><span class="line"><span class="selector-tag">transition-duration</span>: 10<span class="selector-tag">s</span>, 20<span class="selector-tag">s</span>, 200<span class="selector-tag">ms</span></span><br><span class="line"><span class="selector-tag">transition-duration</span>: <span class="selector-tag">inherit</span></span><br></pre></td></tr></table></figure></p>
<p><strong>transition-timing-function</strong><br>缓动公式，根据时间的推进改变属性值的变换速率，有6种可能的值：</p>
<ul>
<li>ease，逐渐变慢，默认值，ease函数等同于贝塞尔曲线(.25, .1, .25, 1)</li>
<li>linear，匀速，函数等同于贝塞尔曲线(0, 0, 1, 1)</li>
<li>ease-in，加速，函数等同于贝塞尔曲线(.42, 0, 1, 1)</li>
<li>ease-out，减速，函数等同于贝塞尔曲线(0, 0, .58, 1)</li>
<li>ease-in-out，加速然后减速，函数等同于贝塞尔曲线(.42, 0, .58, 1)</li>
<li>cubic-bezier，自定义一个时间曲线，(x1, y1, x2, y2),p1和p2两点取值在[0, 1]区间内，具体曲线效果可参考:<a href="http://cubic-bezier.com/#.17,.67,.83,.67" target="_blank" rel="noopener">cubic-bezier.com</a></li>
</ul>
<p><strong>transition-delay</strong><br>延迟执行时间，单位s、ms，它必须放在基于某些延迟触发的伪类或后来才添加到的元素上的类名才有效，因为需要区分出初始状态和结束状态，比如一个元素的背景色开始是绿色然后动态添加了类名或在<code>:hover</code>中将其变为红色，这样transition才能生效。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#move</span>&#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#move</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: red;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">700px</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">2s</span> ease .<span class="number">3s</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>虽然浏览器还提供了一个动画结束事件给js监听：transitionEnd，但transition动画的可控度还是太差了，不适合作为一个框架的动画引擎实现。</p>
<h4 id="CSS3-animation"><a href="#CSS3-animation" class="headerlink" title="CSS3 animation"></a>CSS3 animation</h4><p>animation是CSS3的另一个重要的模块，它客服了transition的一些缺点，实用性很高。</p>
<p>animation是一个复合样式（类似background、font、border的一样），它可以细分为8个更详细的样式：</p>
<ul>
<li>animation-name<br>关键帧样式规则的名字，即以@keyframes开头的样式规则，可以同时对应多个关键帧样式规则，以逗号<code>,</code>分开</li>
<li>animation-duration<br>动画持续时间，单位s、ms，与transition类似</li>
<li>anitaion-timing-function<br>缓动公式，类似transition命名项目</li>
<li>animation-delay<br>延迟时间，此时间不计入animation-duration</li>
<li>animation-iteration-count<br>动画播放次数，值可以是正整数或infinite、默认只执行1次，这样能防止意外触发动画执行（transition只要改变样式就会执行动画）</li>
<li>animation-direction<br>动画执行方向，有四个可能的值：<ul>
<li>normal，每次都从第一帧（@keyframes中0%或from开始，若不写浏览器会自动补上开始）</li>
<li>alternate，当animation-iteration-count大于1时，让动画像钟摆一样从0%-100%-0%-100%-0%的执行</li>
<li>reverse，与normal相反，从100%开始</li>
<li>alternate-reverse，与alternate类似，但执行顺序从100%-0%-100%-0%</li>
</ul>
</li>
<li>animation-fill-mode<br>当动画执行完一轮（0%-100%或100%-0%），是保持动画前的状态forwards还是此时的状态backwards</li>
<li>animation-play-state<br>用于暂停（paused）或继续（running）动画</li>
</ul>
<p>除了最后两个，前六个可以组合卸载animation属性中：<code>animation: &#39;wobble&#39; 20s ease-in-out 2s infinite alternate</code>,分别是animation-name、animation-duration、animation-timing-function、animation-delay、animation-iteration-count、animation-direction。</p>
<p>此外，animation同时配合有3种事件：</p>
<ul>
<li>animationstart，用于开始时</li>
<li>animationend，结束时</li>
<li>animationiteration，重复播放时</li>
</ul>
<h4 id="mass-Framework基于CSS3的动画引擎"><a href="#mass-Framework基于CSS3的动画引擎" class="headerlink" title="mass Framework基于CSS3的动画引擎"></a>mass Framework基于CSS3的动画引擎</h4><p>基于浏览器的动画API，性能比较高，尤其是在移动端，但由于animation在IE10才开始支持，因此若要应用于PC端，需要自己做适配，若条件不满足那么就需要退回基于JS的动画引擎。</p>
<p>浏览器将所有事件类型的构造器都放在window上，但不可遍历，用Object.getOwnPropertyNames加filter就能得到所有事件构造器，只要存在window.AnimationEvent或window.WebKitAnimationEvent就可以使用基于CSS3的动画引擎，另一个判断方法是通过查看是否存在keyframe样式规则的构造器，它也是放在window上，即window.CSSKeyframeRule。</p>
<p>用CSS实现动画引擎，好处如下：</p>
<ul>
<li>自带缓动参数</li>
<li>不用计算原始值，自行内部计算</li>
<li>颜色值不用转换为RGB数组</li>
<li>若想做倒带动画，直接设置animation-iteration-count为2，animation-direction问哦alternate即可</li>
<li>hide效果需要在动画结束时将原来的动画样式还原为初始值，在CSS3中，只需要animation-fill-mode设置为backwards</li>
<li>暂停和继续，通过控制animation-play-state即可</li>
</ul>
<p>与JS动画引擎相比，CSS动画引擎是通过添加类名与插入样式规则实现的，现代浏览器（IE10+以及Chrome、FF等）可以直接使用el.classList.add来添加类名，只要支持animation，那么浏览器就支持动态插入样式，虽然API比较偏门。</p>
<p>在浏览器中，有2个元素能够动态生成样式表，link和style标签，其有一个sheet样式表对象，在sheet下有一个包含所有样式规则的CSSRules类数组对象。而样式规则至少有5种类型：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.move</span> &#123;</span></span><br><span class="line"><span class="undefined">  animataion: move 5s linear;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">@<span class="keyword">keyframes</span> move &#123;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">from</span> &#123;<span class="attribute">margin-left</span>: -<span class="number">20%</span>&#125;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">to</span> &#123;<span class="attribute">margin-left</span>: <span class="number">100%</span>&#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">@<span class="keyword">font-face</span> &#123;<span class="attribute">font-family</span>: <span class="string">"iconfont"</span>;</span></span><br><span class="line"><span class="undefined">  src: url('iconfont.eot?t=1515030873392'); /* IE9*/</span></span><br><span class="line"><span class="undefined">  src: url('iconfont.eot?t=1515030873392#iefix') format('embedded-opentype'), /* IE6-IE8 */</span></span><br><span class="line"><span class="undefined">  url('data:application/x-font-woff;charset=utf-8;base64,d09G...') format('woff'),</span></span><br><span class="line"><span class="undefined">  url('iconfont.ttf?t=1515030873392') format('truetype'), /* chrome, firefox, opera, Safari, Android, iOS 4.2+*/</span></span><br><span class="line"><span class="undefined">  url('iconfont.svg?t=1515030873392#iconfont') format('svg'); /* iOS 4.1- */</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">@<span class="keyword">media</span> screen &#123;</span></span><br><span class="line"><span class="css">  <span class="selector-id">#element</span> &#123; <span class="attribute">background</span>: red&#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>如上述代码，从上到下依次是：</p>
<ol>
<li>CSSStyleRule，最早的类型，通过其selectorText可以取得指定的样式规则，比如上例的selectorText为<code>.move</code></li>
<li>CSSKeyframesRule,就是以@keyframes开头的样式规则，可通过专有的name属性判断，它里面指定进度呈现的样式规则，用户在定义时可能用到to、from，但在DOM时全部会转换为百分比，它们通过keyText属性进行区分，同时其包括以百分比命名的CSSKeyframeRule</li>
<li>CSSFontFaceRule，用于加载自定义字体</li>
<li>CSSMediaRule，用于响应式布局，</li>
</ol>
<p>为了方便操作，可以把动画引擎自己产生的样式规则全部放到一个动态插入的style元素中，以后删除就在这个元素内找，这样可减少遍历次数。</p>
<p><a href="https://github.com/RubyLouvre/mass-Framework/blob/master/fx_neo.js">mass Framework CSS3动画源码地址</a></p>
<p>mass Framework用于操作样式规则的源码如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//========================样式规则相关辅助函数==================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> styleElement;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">insertCSSRule</span>(<span class="params">rule</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//动态插入一条样式规则</span></span><br><span class="line">  <span class="keyword">if</span> (styleElement) &#123;</span><br><span class="line">      <span class="keyword">var</span> number = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> sheet = styleElement.sheet;<span class="comment">// styleElement.styleSheet;</span></span><br><span class="line">          <span class="keyword">var</span> cssRules = sheet.cssRules; <span class="comment">// sheet.rules;</span></span><br><span class="line">          number = cssRules.length;</span><br><span class="line">          sheet.insertRule(rule, number);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          $.log(e.message + rule);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      styleElement = <span class="built_in">document</span>.createElement(<span class="string">"style"</span>);</span><br><span class="line">      styleElement.innerHTML = rule;</span><br><span class="line">      <span class="built_in">document</span>.head.appendChild(styleElement);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deleteCSSRule</span>(<span class="params">ruleName, keyframes</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//删除一条样式规则</span></span><br><span class="line">  <span class="keyword">var</span> prop = keyframes ? <span class="string">"name"</span> : <span class="string">"selectorText"</span>;</span><br><span class="line">  <span class="keyword">var</span> name = keyframes ? <span class="string">"@keyframes "</span> : <span class="string">"cssRule "</span>;<span class="comment">//调试用</span></span><br><span class="line">  <span class="keyword">if</span> (styleElement) &#123;</span><br><span class="line">      <span class="keyword">var</span> sheet = styleElement.sheet;<span class="comment">// styleElement.styleSheet;</span></span><br><span class="line">      <span class="keyword">var</span> cssRules = sheet.cssRules;<span class="comment">// sheet.rules;</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, n = cssRules.length; i &lt; n; i++) &#123;</span><br><span class="line">          <span class="keyword">var</span> rule = cssRules[i];</span><br><span class="line">          <span class="keyword">if</span> (rule[prop] === ruleName) &#123;</span><br><span class="line">              sheet.deleteRule(i);</span><br><span class="line">              $.log(<span class="string">"已经成功删除"</span> + name + <span class="string">" "</span> + ruleName);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deleteKeyFrames</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//删除一条@keyframes样式规则</span></span><br><span class="line">  deleteCSSRule(name, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上述为操作样式表规则的辅助函数，引擎的主函数$.fn.animate的接口需要处理参数多态化，与jquery保持一致，同时需要考虑如何实现排队，通过元素animationend回调中自动执行下一个动画即可，所有排队的动画全部放到元素对应的缓存体中即可。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=================================参数处理==================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addOption</span>(<span class="params">opts, p</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (<span class="keyword">typeof</span> p) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"object"</span>:</span><br><span class="line">          $.mix(opts, p);</span><br><span class="line">          <span class="keyword">delete</span> p.props;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"number"</span>:</span><br><span class="line">          opts.duration = p;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"string"</span>:</span><br><span class="line">          opts.easing = p;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"function"</span>:</span><br><span class="line">          opts.complete = p;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addOptions</span>(<span class="params">duration</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> opts = &#123;&#125;;</span><br><span class="line">  <span class="comment">//如果第二参数是对象</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; <span class="built_in">arguments</span>.length; i++) &#123;</span><br><span class="line">      addOption(opts, <span class="built_in">arguments</span>[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  duration = opts.duration;</span><br><span class="line">  duration = <span class="regexp">/^\d+(ms|s)?$/</span>.test(duration) ? duration + <span class="string">""</span> : <span class="string">"1000ms"</span>;</span><br><span class="line">  <span class="keyword">if</span> (duration.indexOf(<span class="string">"s"</span>) === <span class="number">-1</span>) &#123;</span><br><span class="line">      duration += <span class="string">"ms"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  opts.duration = duration;</span><br><span class="line">  opts.effect = opts.effect || <span class="string">"fx"</span>;</span><br><span class="line">  opts.queue = !!(opts.queue == <span class="literal">null</span> || opts.queue); <span class="comment">//默认使用列队</span></span><br><span class="line">  opts.easing = easingMap[opts.easing] ? opts.easing : <span class="string">"easeIn"</span>;</span><br><span class="line">  <span class="keyword">return</span> opts;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面的easingMap对象里包含所有常见缓动公式名及其对应的贝塞尔曲线的实现。</p>
<p>接着就是3个重要的执行函数：startAnimation、nextAnimation、stopAnimation：</p>
<ul>
<li>startAnimation，用于立即执行此元素的动画，具体实现是分解原始数据构建两个样式规则，一个用于集中定义动画的运动情况，另一个是定义第一帧与最后一帧的样式。第一个样式规则是普通的CSSStyleRule，selectorText表示类名，添加到目标元素上，另一个是CSSKeyframesRule。由于多个元素可共用类名，若样式表有此类名了则无需重复分解构建，因此需要一个标识flag，最后需要绑定animationend事件，在其的回调中保存指定样式到元素的style中，然后移除类名（因为类名对应规则样式最后一定会被移除，所以需要将它们转移到内联样式中），并调用nextAnimation与stopAnimation</li>
<li>nextAnimation决定是否调用startAnimation，里面有一个setTimeout定时器，用于模拟delay效果</li>
<li>stopAnimation用于移除startAnimation插入的两个样式规则</li>
</ul>
<p>startAnimation源码中，有两个重要的标识flag：</p>
<ul>
<li>AnimationRegister用于存储类名，类名的值为数字，表示有多少个元素在共用它，只有在这个值为零时进行分解与插入样式规则，然后每当动画结束时，值减一，归零时移除</li>
<li>第二个flag是缓存体中的动画队列中的busy，进行动画或被延迟时为true，其他时间为false，当为false时才能进入startAnimation的分支<br>在startAnimation中，有时会调用AnimationPreprocess里的预处理函数，因为CSS3规定display为none的元素无法进行动画，所以要想实现show效果，需要提前修改display值。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> AnimationRegister = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">startAnimation</span>(<span class="params">node, id, props, opts</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> effectName = opts.effect;</span><br><span class="line">  <span class="keyword">var</span> className = <span class="string">"fx_"</span> + effectName + <span class="string">"_"</span> + id;</span><br><span class="line">  <span class="keyword">var</span> frameName = <span class="string">"keyframe_"</span> + effectName + <span class="string">"_"</span> + id;</span><br><span class="line">  <span class="comment">//这里可能要做某些处理, 比如隐藏元素要进行动画, display值不能为none</span></span><br><span class="line">  <span class="keyword">var</span> hidden = $.css(node, <span class="string">"display"</span>) === <span class="string">"none"</span>;</span><br><span class="line">  <span class="keyword">var</span> preproccess = AnimationPreproccess[effectName];</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> preproccess === <span class="string">"function"</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> ret = preproccess(node, hidden, props, opts);</span><br><span class="line">      <span class="keyword">if</span> (ret === <span class="literal">false</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//各种回调</span></span><br><span class="line">  <span class="keyword">var</span> after = opts.after || $.noop;</span><br><span class="line">  <span class="keyword">var</span> before = opts.before || $.noop;</span><br><span class="line">  <span class="keyword">var</span> complete = opts.complete || $.noop;</span><br><span class="line">  <span class="keyword">var</span> <span class="keyword">from</span> = [],</span><br><span class="line">          to = [];</span><br><span class="line">  <span class="keyword">var</span> count = AnimationRegister[className];</span><br><span class="line">  node[className] = props;<span class="comment">//保存到元素上，方便stop方法调用</span></span><br><span class="line">  <span class="comment">//让一组元素共用同一个类名</span></span><br><span class="line">  <span class="keyword">if</span> (!count) &#123;</span><br><span class="line">      <span class="comment">//如果样式表中不存在这两条样式规则</span></span><br><span class="line">      count = AnimationRegister[className] = <span class="number">0</span>;</span><br><span class="line">      $.each(props, <span class="function"><span class="keyword">function</span>(<span class="params">key, val</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> selector = key.replace(<span class="regexp">/[A-Z]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="string">"-"</span> + a.toLowerCase();</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">var</span> parts;</span><br><span class="line">          <span class="comment">//处理show toggle hide三个特殊值</span></span><br><span class="line">          <span class="keyword">if</span> (val === <span class="string">"toggle"</span>) &#123;</span><br><span class="line">              val = hidden ? <span class="string">"show"</span> : <span class="string">"hide"</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (val === <span class="string">"show"</span>) &#123;</span><br><span class="line">              <span class="keyword">from</span>.push(selector + <span class="string">":0"</span> + ($.cssNumber[key] ? <span class="string">""</span> : <span class="string">"px"</span>));</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (val === <span class="string">"hide"</span>) &#123; <span class="comment">//hide</span></span><br><span class="line">              to.push(selector + <span class="string">":0"</span> + ($.cssNumber[key] ? <span class="string">""</span> : <span class="string">"px"</span>));</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (parts = rfxnum.exec(val)) &#123;</span><br><span class="line">              <span class="keyword">var</span> delta = <span class="built_in">parseFloat</span>(parts[<span class="number">2</span>]);</span><br><span class="line">              <span class="keyword">var</span> unit = $.cssNumber[key] ? <span class="string">""</span> : (parts[<span class="number">3</span>] || <span class="string">"px"</span>);</span><br><span class="line">              <span class="keyword">if</span> (parts[<span class="number">1</span>]) &#123; <span class="comment">//操作符</span></span><br><span class="line">                  <span class="keyword">var</span> operator = parts[<span class="number">1</span>].charAt(<span class="number">0</span>);</span><br><span class="line">                  <span class="keyword">var</span> init = <span class="built_in">parseFloat</span>($.css(node, key));</span><br><span class="line">                  <span class="keyword">try</span> &#123;</span><br><span class="line">                      delta = <span class="built_in">eval</span>(init + operator + delta);</span><br><span class="line">                  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                      $.error(<span class="string">"使用-=/+=进行递增递减操作时,单位只能为px, deg"</span>, <span class="built_in">TypeError</span>);</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              to.push(selector + <span class="string">":"</span> + delta + unit);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              to.push(selector + <span class="string">":"</span> + val);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">var</span> easing = <span class="string">"cubic-bezier( "</span> + easingMap[opts.easing] + <span class="string">" )"</span>;</span><br><span class="line">      <span class="comment">//CSSStyleRule的模板</span></span><br><span class="line">      <span class="keyword">var</span> classRule = <span class="string">".#&#123;className&#125;&#123; #&#123;prefix&#125;animation: #&#123;frameName&#125; #&#123;duration&#125; #&#123;easing&#125; "</span> +</span><br><span class="line">              <span class="string">"#&#123;count&#125; #&#123;direction&#125;; #&#123;prefix&#125;animation-fill-mode:#&#123;mode&#125;  &#125;"</span>;</span><br><span class="line">      <span class="comment">//CSSKeyframesRule的模板</span></span><br><span class="line">      <span class="keyword">var</span> frameRule = <span class="string">"@#&#123;prefix&#125;keyframes #&#123;frameName&#125;&#123; 0%&#123; #&#123;from&#125;; &#125; 100%&#123;  #&#123;to&#125;; &#125;  &#125;"</span>;</span><br><span class="line">      <span class="keyword">var</span> mode = effectName === <span class="string">"hide"</span> ? <span class="string">"backwards"</span> : <span class="string">"forwards"</span>;</span><br><span class="line">      <span class="comment">//填空数据</span></span><br><span class="line">      <span class="keyword">var</span> rule1 = $.format(classRule, &#123;</span><br><span class="line">          className: className,</span><br><span class="line">          duration: opts.duration,</span><br><span class="line">          easing: easing,</span><br><span class="line">          frameName: frameName,</span><br><span class="line">          mode: mode,</span><br><span class="line">          prefix: prefixCSS,</span><br><span class="line">          count: opts.revert ? <span class="number">2</span> : <span class="number">1</span>,</span><br><span class="line">          direction: opts.revert ? <span class="string">"alternate"</span> : <span class="string">""</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">var</span> rule2 = $.format(frameRule, &#123;</span><br><span class="line">          frameName: frameName,</span><br><span class="line">          prefix: prefixCSS,</span><br><span class="line">          <span class="keyword">from</span>: <span class="keyword">from</span>.join(<span class="string">"; "</span>),</span><br><span class="line">          to: to.join(<span class="string">";"</span>)</span><br><span class="line">      &#125;);</span><br><span class="line">      insertCSSRule(rule1);</span><br><span class="line">      insertCSSRule(rule2);</span><br><span class="line">  &#125;</span><br><span class="line">  AnimationRegister[className] = count + <span class="number">1</span>;</span><br><span class="line">  $.bind(node, animationend, <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">      $.unbind(<span class="keyword">this</span>, event.type, fn);</span><br><span class="line">      <span class="keyword">var</span> styles = <span class="built_in">window</span>.getComputedStyle(node, <span class="literal">null</span>);</span><br><span class="line">      <span class="comment">// 保存最后的样式</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> props) &#123;</span><br><span class="line">          <span class="keyword">if</span> (props.hasOwnProperty(i)) &#123;</span><br><span class="line">              node.style[i] = styles[i];</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      node.classList.remove(className); <span class="comment">//移除类名</span></span><br><span class="line">      stopAnimation(className); <span class="comment">//尝试移除keyframe</span></span><br><span class="line">      after(node);</span><br><span class="line">      complete(node);</span><br><span class="line">      <span class="keyword">var</span> queue = $._data(node, <span class="string">"fxQueue"</span>);</span><br><span class="line">      <span class="keyword">if</span> (opts.queue &amp;&amp; queue) &#123; <span class="comment">//如果在列状,那么开始下一个动画</span></span><br><span class="line">          queue.busy = <span class="number">0</span>;</span><br><span class="line">          nextAnimation(node, queue);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  before(node);</span><br><span class="line">  node.classList.add(className);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>nextAnimation和stopAnimation源码如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">nextAnimation</span>(<span class="params">node, queue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!queue.busy) &#123;</span><br><span class="line">      queue.busy = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">var</span> args = queue.shift();</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">isFinite</span>(args)) &#123;<span class="comment">//如果是数字</span></span><br><span class="line">          setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              queue.busy = <span class="number">0</span>;</span><br><span class="line">              nextAnimation(node, queue);</span><br><span class="line">          &#125;, args);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(args)) &#123;</span><br><span class="line">          startAnimation(node, args[<span class="number">0</span>], args[<span class="number">1</span>], args[<span class="number">2</span>]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          queue.busy = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stopAnimation</span>(<span class="params">className</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> count = AnimationRegister[className];</span><br><span class="line">  <span class="keyword">if</span> (count) &#123;</span><br><span class="line">      AnimationRegister[className] = count - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> (AnimationRegister[className] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> frameName = className.replace(<span class="string">"fx"</span>, <span class="string">"keyframe"</span>);</span><br><span class="line">          deleteKeyFrames(frameName);</span><br><span class="line">          deleteCSSRule(<span class="string">"."</span> + className);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>而delay、pause、resume这几个方法的实现如下,改变animation-play-state这个CSS3属性的值即可：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> playState = $.cssName(<span class="string">"animation-play-state"</span>);</span><br><span class="line"><span class="comment">// 略...</span></span><br><span class="line">$.fn.delay = <span class="function"><span class="keyword">function</span>(<span class="params">number</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.fx(number);</span><br><span class="line">&#125;;</span><br><span class="line">$.fn.pause = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.style[playState] = <span class="string">"paused"</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">$.fn.resume = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.style[playState] = <span class="string">"running"</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>基于CSS3的动画引擎的缺点如下：</p>
<ul>
<li>对scrollTop、scrollLeft的动画无能为力，它们是元素的属性，不是CSS样式</li>
<li>对canvas元素中的矢量图形无效</li>
</ul>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2018/01/10/js-framework15/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            Newer
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2018/01/08/js-framework13/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>
    <!-- modified By KING 2017.11.16 -->
    <!-- Sidebar Avatar
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="KING's avatar">
    </div> -->

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        xmoyking@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="https://github.com/xmoyKing/xmoyKing.github.io" target="_blank" title="Star Me on GitHub">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">star</i>
                        
                        Star Me on GitHub
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                Home
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    Archives
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2018/01/">January 2018<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">December 2017<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">November 2017<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">October 2017<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">September 2017<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">August 2017<span class="sidebar_archives-count">13</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">July 2017<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">June 2017<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">May 2017<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">April 2017<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">March 2017<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">February 2017<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">January 2017<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">November 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">October 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">September 2016<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">August 2016<span class="sidebar_archives-count">20</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                Categories
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Angular/">Angular<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/categories/Nodejs/">Nodejs<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/categories/TypeScript/">TypeScript<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/WebApp/">WebApp<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/categories/angularjs/">angularjs<span class="sidebar_archives-count">50</span></a></li><li><a class="sidebar_archives-link" href="/categories/css/">css<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/categories/java/">java<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/js/">js<span class="sidebar_archives-count">88</span></a></li><li><a class="sidebar_archives-link" href="/categories/linux/">linux<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/categories/mixed/">mixed<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/categories/mongodb/">mongodb<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/python/">python<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="Tags">
                
                    <i class="material-icons sidebar-material-icons">bookmark</i>
                
                Tags
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
    
        <li>
            <a href="/about/links.html" title="Links">
                
                    <i class="material-icons sidebar-material-icons">polymer</i>
                
                Links
            </a>
        </li>
        
    
        <li>
            <a href="http://www.filmboard.cn" title="Works">
                
                    <i class="material-icons sidebar-material-icons">code</i>
                
                Works
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                Number of articles
                <span class="sidebar-badge">208</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    
        <a href="https://plus.google.com/114920706759690760782" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    
        <a href="http://weibo.com/p/1005052419772155" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-weibo">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="http://github.com/xmoyking" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>KING · NOTE
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/lazyload.min.js", true)</script>



    <script>lsloader.load("js_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/js.min.js", true)</script>



    <script>lsloader.load("np_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/nprogress.js", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
