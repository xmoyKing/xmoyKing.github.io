<!DOCTYPE html>
<html style="display: none;" lang="en">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.0 -->
    <script>
        window.materialVersion = "1.5.0"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">

    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source"/>














    <!-- Title -->
    
    <title>
        
            Node 技巧笔记5 - fs模块 | 
        
        KING · NOTE
    </title>

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="KING">
    <meta name="description" itemprop="description" content="Loneliness is the carnival of one single soul.">
    <meta name="keywords" content=",JavaScript,Nodejs,fs模块">

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(window.oldVersion){var remove=window.oldVersion.reduce(function(p,c){return p||data.indexOf("/*"+c+"*/")!==-1},false);if(remove){lsloader.removeLS(key)}}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload,isJs){if(typeof cssonload==="boolean"){isJs=cssonload;cssonload=undefined}isJs=isJs||false;cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}code=code.split(versionString)[1];if(isJs){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload,isJs)}};lsloader.requestResource=function(name,path,cssonload,isJs){var that=this;if(isJs){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else{this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="KING · NOTE">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/css/material.min.css",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/css/style.min.css",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->
<!-- add By KING 2017.11.16 -->
<link rel="stylesheet" href="/css/highlightjs/vs.css">
<style>
  #scheme-Paradox .material-layout .highlight .meta{
    display: initial;
    padding: initial;
  }
</style>


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icon -->

    <style>
        @font-face {
            font-family: 'Material Icons';
            font-style: normal;
            font-weight: 400;
            src: local('Material Icons'),
            local('MaterialIcons-Regular'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.woff2) format('woff2'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.woff) format('woff'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.ttf) format('truetype');
        }
    </style>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/jquery.min.js", true)</script>
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="https://github.com/xmoyKING">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Node 技巧笔记5 - fs模块 | KING · NOTE">
    <meta property="og:image" content="https://github.com/xmoyKING/img/favicon.png" />
    <meta property="og:description" content="Loneliness is the carnival of one single soul.">
    <meta property="og:article:tag" content="JavaScript"> <meta property="og:article:tag" content="Nodejs"> <meta property="og:article:tag" content="fs模块"> 

    
        <meta property="article:published_time" content="Thu Apr 05 2018 16:03:12 GMT+0800" />
        <meta property="article:modified_time" content="Thu Apr 05 2018 16:03:12 GMT+0800" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="Node 技巧笔记5 - fs模块 | KING · NOTE">
    <meta name="twitter:description" content="Loneliness is the carnival of one single soul.">
    <meta name="twitter:image" content="https://github.com/xmoyKING/img/favicon.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://github.com/xmoyKING" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="https://github.com/xmoyKING/2018/04/05/node-in-practice5/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "https://github.com/xmoyKING/2018/04/05/node-in-practice5/index.html",
    "headline": "Node 技巧笔记5 - fs模块",
    "datePublished": "Thu Apr 05 2018 16:03:12 GMT+0800",
    "dateModified": "Thu Apr 05 2018 16:03:12 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "KING",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": "Loneliness is the carnival of one single soul."
    },
    "publisher": {
        "@type": "Organization",
        "name": "KING · NOTE",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",JavaScript,Nodejs,fs模块",
    "description": "Loneliness is the carnival of one single soul.",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#技巧39-读取配置文件"><span class="post-toc-number">1.</span> <span class="post-toc-text">技巧39 读取配置文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#技巧40-使用文件描述符（File-descriptor）"><span class="post-toc-number">2.</span> <span class="post-toc-text">技巧40 使用文件描述符（File descriptor）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#技巧41-使用文件锁"><span class="post-toc-number">3.</span> <span class="post-toc-text">技巧41 使用文件锁</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#技巧42-递归文件操作"><span class="post-toc-number">4.</span> <span class="post-toc-text">技巧42 递归文件操作</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#技巧43-简单文件数据库"><span class="post-toc-number">5.</span> <span class="post-toc-text">技巧43 简单文件数据库</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#技巧44-监视文件夹以及文件"><span class="post-toc-number">6.</span> <span class="post-toc-text">技巧44 监视文件夹以及文件</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                Node 技巧笔记5 - fs模块
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>KING</strong>
        <span>Apr 05, 2018</span>
        <!-- Updated Time , add By KING 2017.11.16 -->
        <span>Apr 05, 2018 UPDATED</span> 
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/JavaScript/">JavaScript</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/Nodejs/">Nodejs</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/fs模块/">fs模块</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Node 技巧笔记5 - fs模块&url=https://github.com/xmoyKING/2018/04/05/node-in-practice5/index.html&pic=https://github.com/xmoyKING/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                Share to Weibo
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Node 技巧笔记5 - fs模块&url=https://github.com/xmoyKING/2018/04/05/node-in-practice5/index.html&via=KING" target="_blank">
            <li class="mdl-menu__item">
                Share to Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://github.com/xmoyKING/2018/04/05/node-in-practice5/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=https://github.com/xmoyKING/2018/04/05/node-in-practice5/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>Node的核心模块通常是低级别的API，而fs模块通过以下的方式运行开发与文件系统交互：</p>
<ul>
<li>POSIX文件I/O</li>
<li>文件流</li>
<li>批量文件I/O</li>
<li>文件监控</li>
</ul>
<p>fs模块相较其他I/O模块（如net、http），不仅有异步接口，也有同步接口。文件系统的同步接口很大部分是因为Node的内部工作方式，比如模块系统、require方法就是同步的。</p>
<p>fs模块包含常规的POSIX文件操作的封装，比如readdir在Node中对应的fs.readdir方法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line">fs.readdir(<span class="string">'/path/dir'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, files</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(files);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="技巧39-读取配置文件"><a href="#技巧39-读取配置文件" class="headerlink" title="技巧39 读取配置文件"></a>技巧39 读取配置文件</h3><p>把配置文件放在单独的文件中非常有用，尤其是当应用运行在多个环境下时（开发环境、测试环境、生成环境）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> config = <span class="built_in">JSON</span>.parse(fs.readFileSync(<span class="string">'./config.json'</span>).toString());</span><br><span class="line"></span><br><span class="line">  doThings(config);</span><br><span class="line">&#125;<span class="keyword">catch</span>(err)&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(err);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一般在系统初始化时加载配置文件，可以通过同步的方式读取。<br>通过readFileSync拿到的数据是buffer，需要将其转换为字符串，然后解析为JSON。<br>同步的错误可以通过标准try-catch捕获。</p>
<p>其实，通过require直接加载JSON文件更方便<code>const require(&#39;./config.json&#39;);</code>，但这种方式下，模块会被全局缓存，所以有其他模块也需要加载并修改了配置，则会影响到全局所有的配置。因此最好将其配置文件内容定义为const常量。</p>
<h3 id="技巧40-使用文件描述符（File-descriptor）"><a href="#技巧40-使用文件描述符（File-descriptor）" class="headerlink" title="技巧40 使用文件描述符（File descriptor）"></a>技巧40 使用文件描述符（File descriptor）</h3><p>文件描述符是在操作系统中管理的在进程中打开文件所关联的一些索引（数字类型），操作系统通过指派一个唯一的证书给每个打开的文件用来查看关于这个文件的信息。</p>
<p>可以通过fs文件描述符来读写文件。而文件描述符不仅仅可指向文件，还可以指向目录、管道、网络套接字、标准流等。比如</p>
<table>
<thead>
<tr>
<th>标准流</th>
<th>文件描述符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>stdin</td>
<td>0</td>
<td>标准输入流</td>
</tr>
<tr>
<td>stdout</td>
<td>1</td>
<td>标准输出流</td>
</tr>
<tr>
<td>stderr</td>
<td>2</td>
<td>标准错误流</td>
</tr>
</tbody>
</table>
<p>而Node中，console.log()其实就是stdout的语法糖，通过使用全局process对象，也可以实现打印输出。<br><code>process.stdout.write(&#39;some log to stdout&#39;)</code></p>
<p>fs模块有一个很少使用的方法，即将文件描述符作为第一个参数。比如通过fs.writeSync写入文件描述符1（即stdout）：<br><code>fs.writeSync(1, &#39;some log to stdout&#39;)</code>，</p>
<p>三种打印的效果相同，是因为Node中，console.log和process.stdout.write实际上是同步的方法。</p>
<p>文件描述符非常有用，尤其是在多进程和多线程编程时。</p>
<h3 id="技巧41-使用文件锁"><a href="#技巧41-使用文件锁" class="headerlink" title="技巧41 使用文件锁"></a>技巧41 使用文件锁</h3><p>在需要协同多个进程同时访问一个文件并且保证文件的完整性时文件锁就非常有用了。例如锁住文件防止多个进程篡改文件。</p>
<p>Node本身不能实现直接锁住文件，无论是强制锁还是咨询锁，其中咨询锁可以用过调用系统调用（syscalls）实现，如flock。</p>
<p>在Node中，除了flock方法，还可以使用锁文件实现，所谓锁文件，其实就是普通的文件或文件夹，它作为一个标记，存在时就说明其他资源正在使用资源。锁文件的创建必须是原子性的，这样才能避免冲突。</p>
<p>可以通过一些方法来实现锁文件：</p>
<ul>
<li>使用独占标记创建锁文件</li>
<li>使用mkdir创建锁文件</li>
</ul>
<p><strong>使用独占标记创建锁文件</strong><br>fs模块为所有需要打开文件的方法（如fs.writeFile、fs.createWriteStream、fs.open）都提供了一个x标记，即表示以执行模式打开（0_EXCL），执行模式是独占的，也就是说当使用这个方法时，若这个文件存在，则文件不能被打开。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以可执行、可写入模式打开</span></span><br><span class="line">fs.open(<span class="string">'lockfile.lock'</span>, <span class="string">'wx'</span>, err=&gt;&#123;</span><br><span class="line">  <span class="comment">// 包括文件存在都会返回失败</span></span><br><span class="line">  <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">  <span class="comment">// ... 安全修改资源</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>一般来说，可以将当前进程的PID写入锁文件而不是仅仅打开一个空文件，这样当有异常时，可以知道最后使用锁的进程。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fs.writeFile(<span class="string">'lockfile.lock'</span>, process.id, &#123;<span class="attr">flags</span>: <span class="string">'wx'</span>&#125;, err=&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">  <span class="comment">// ... 安全修改资源</span></span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>使用mkdir创建锁文件</strong><br>上面的锁文件有可能会无法工作，比如某些系统在远程硬盘上无法识别0_EXCL标记，此时的策略就是将创建文件改为创建文件夹，mkdir也是原子性的操作，无法并发，而且支持跨平台。当目录名已经存在时，mkdir会失败，可以将PID写入该目录下的文件内。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fs.mkdir(<span class="string">'lockdir'</span>, err=&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line"></span><br><span class="line">  fs.writeFile(<span class="string">'lockdir/lockfile_'</span>+ process.id, err=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    <span class="comment">// ... 安全修改资源</span></span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>上述2种方式完成了锁文件的创建，但还需要一个方法在操作结束时删除锁文件，同时需要在进程退出时，将所有锁文件都删除，这些操作可以封装在一个简单模块中：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> lockDir = <span class="string">'lockDir'</span>;</span><br><span class="line"><span class="keyword">let</span> hasLock = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义获取锁方法</span></span><br><span class="line">exports.lock = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(hasLock) <span class="keyword">return</span> cb(); <span class="comment">// 若已经获取锁</span></span><br><span class="line"></span><br><span class="line">    fs.mkdir(lockDir, err=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> cb(err); <span class="comment">// 无法创建锁</span></span><br><span class="line">        <span class="comment">// 写入PID，方便调试</span></span><br><span class="line">        fs.writeFile(lockDir+<span class="string">'/'</span>+process.pid, err=&gt;&#123;</span><br><span class="line">            <span class="keyword">if</span>(err) <span class="built_in">console</span>.error(err); <span class="comment">// 若无法写入PID，则打印并继续运行</span></span><br><span class="line"></span><br><span class="line">            hasLock = <span class="literal">true</span>; <span class="comment">// 设置已创建锁的标识</span></span><br><span class="line">            <span class="keyword">return</span> cb();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义释放锁方法</span></span><br><span class="line">exports.unlock = <span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!hasLock) <span class="keyword">return</span> cb(); <span class="comment">// 没有可释放的锁</span></span><br><span class="line">    <span class="comment">// 与获取锁的方式相反，先删除文件，然后删除文件夹</span></span><br><span class="line">    fs.unlink(lockDir+<span class="string">'/'</span>+process.pid, err=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> cb(err);</span><br><span class="line"></span><br><span class="line">        fs.rmdir(lockDir, err=&gt;&#123;</span><br><span class="line">            <span class="keyword">if</span>(err) <span class="built_in">console</span>.error(err); <span class="comment">// 若无法写入PID，则打印并继续运行</span></span><br><span class="line"></span><br><span class="line">            hasLock = <span class="literal">false</span>;</span><br><span class="line">            cb();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">process.on(<span class="string">'exit'</span>, ()=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(hasLock)&#123; <span class="comment">// 若还有锁存在，则退出前需要释放掉</span></span><br><span class="line">        fs.unlinkSync(lockDir+<span class="string">'/'</span>+process.pid);</span><br><span class="line">        fs.rmdirSync(lockDir);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'released lock'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>测试用法<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> locker = <span class="built_in">require</span>(<span class="string">'./locker'</span>);</span><br><span class="line"><span class="comment">// 获取锁</span></span><br><span class="line">locker.lock(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="comment">// 操作...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 操作完成后释放锁</span></span><br><span class="line">    locker.unlock(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// ... 释放锁之后的回调</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>关于独占模式的实现，可查看<a href="https://github.com/npm/lockfile">lockfile模块的实现</a></p>
<h3 id="技巧42-递归文件操作"><a href="#技巧42-递归文件操作" class="headerlink" title="技巧42 递归文件操作"></a>技巧42 递归文件操作</h3><p>有时候需要像<code>rm -rf</code>那样删除一个目录以及它下面的所有子目录，或者创建一个目录的同时也创建所有中间目录。此时需要用到递归文件操作。递归操作易用，但也易错，尤其是在异步操作时。</p>
<p>fs提供了一些基本方法：</p>
<ul>
<li>fs.readdir/fs.readdirSync 通过输入的地址参数列出所有文件（包括目录）</li>
<li>fs.stat/fs.statSync 返回指定路径的文件信息，无论该路径是文件还是目录</li>
</ul>
<p>一般来说，同步递归遍历比异步递归快，但当碰到很大的文件目录时（包含的文件和子目录多），同步调用会执行失败，会栈溢出。若开启了尾递归则就可以。</p>
<p>之所以同步较快是因为同步不会延迟执行，但同时会阻塞I/O和其他事件的执行。</p>
<p>实现代码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; stat &#125; <span class="keyword">from</span> <span class="string">'fs'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> join = <span class="built_in">require</span>(<span class="string">'path'</span>).join;</span><br><span class="line"><span class="comment">// nameRe为文件名正则，startPath表示开始搜索路径</span></span><br><span class="line"><span class="comment">// 异步方法</span></span><br><span class="line">exports.findSync = <span class="function"><span class="keyword">function</span>(<span class="params">nameRe, startPath</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> rst = [];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">finder</span>(<span class="params">path</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> files = fs.readdirSync(path);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; files.length; i++)&#123;</span><br><span class="line">            <span class="keyword">let</span> fpath = join(path, files[i]);</span><br><span class="line">            <span class="keyword">let</span> stats = fs.statSync(fpath);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(stats.isDirectory()) finder(fpath);</span><br><span class="line">            <span class="keyword">if</span>(stats.isFile() &amp;&amp; nameRe.test(files[i])) rst.push(fpath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    finder(startPath);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rst;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// find方法接收一个回调函数</span></span><br><span class="line">exports.find = <span class="function"><span class="keyword">function</span>(<span class="params">nameRe, startPath, cb</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> rst = [],</span><br><span class="line">        asyncOps = <span class="number">0</span>, <span class="comment">// 为了知道是否完成遍历，需要一个计数器，其在执行异步前加一，执行完后减一</span></span><br><span class="line">        errored = <span class="literal">false</span>; <span class="comment">// 为了防止多个错误调用，可通过err追踪错误</span></span><br><span class="line">    <span class="comment">// 处理错误的函数，用于确保多个错误，仅回调一次</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">error</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!errored) cb(err);</span><br><span class="line"></span><br><span class="line">        errored = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">finder</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">        asyncOps++; <span class="comment">// 每一次异步操作都需要增加计数器</span></span><br><span class="line">        fs.readdir(path, (err, files)=&gt;&#123;</span><br><span class="line">            <span class="keyword">if</span>(err) <span class="keyword">return</span> error(err);</span><br><span class="line"></span><br><span class="line">            files.forEach(<span class="function"><span class="params">file</span>=&gt;</span>&#123; <span class="comment">// 此处需要闭包，防止丢失文件引用</span></span><br><span class="line">                <span class="keyword">let</span> fpath = join(path, file);</span><br><span class="line"></span><br><span class="line">                asyncOps++;</span><br><span class="line">                fs.stat(fpath, (err,stats)=&gt;&#123;</span><br><span class="line">                    <span class="keyword">if</span>(err) <span class="keyword">return</span> error(err);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(stats.isDirectory()) finder(fpath);</span><br><span class="line">                    <span class="keyword">if</span>(stats.isFile() &amp;&amp; nameRe.test(file)) rst.push(fpath);</span><br><span class="line"></span><br><span class="line">                    asyncOps--; <span class="comment">// 若计数器归零则说明没有错误，则执行回调</span></span><br><span class="line">                    <span class="keyword">if</span>(asyncOps == <span class="number">0</span>) cb(<span class="literal">null</span>, rst);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            asyncOps--;</span><br><span class="line">            <span class="keyword">if</span>(asyncOps == <span class="number">0</span>) cb(<span class="literal">null</span>, rst);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    finder(startPath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试同步调用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testSync</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> finder = <span class="built_in">require</span>(<span class="string">'./finder'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> rst = finder.findSync(<span class="regexp">/file.*/</span>, <span class="string">'/path/of/start'</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(rst);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 测试异步调用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFind</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> finder = <span class="built_in">require</span>(<span class="string">'./finder'</span>);</span><br><span class="line">    finder.findSync(<span class="regexp">/file.*/</span>, <span class="string">'/path/of/start'</span>, (err, rst)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(rst);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="技巧43-简单文件数据库"><a href="#技巧43-简单文件数据库" class="headerlink" title="技巧43 简单文件数据库"></a>技巧43 简单文件数据库</h3><p>通过Node的fs模块提供的功能，可以构建出复杂的递归操作的工具。同时也能完成其他复杂任务，比如创建一个简单的文件数据。</p>
<p>数据库存储的格式为key/value的JSON格式，每行一个记录，通过追加日志的方式，使用内存数据库可以保证一致性，且能简单通过复制文件备份数据库。</p>
<p>需要简单易用，使用方式为：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Database = <span class="built_in">require</span>(<span class="string">'./database'</span>); <span class="comment">// 加载数据库模块</span></span><br><span class="line"><span class="keyword">let</span> client = <span class="keyword">new</span> Database(<span class="string">'./test.db'</span>); <span class="comment">// 提供加载/创建的数据库文件路径</span></span><br><span class="line"></span><br><span class="line">client.on(<span class="string">'load'</span>, ()=&gt;&#123; <span class="comment">// 当数据加载到内存中时，触发load事件</span></span><br><span class="line">    <span class="keyword">let</span> foo = client.get(<span class="string">'foo'</span>); <span class="comment">// 使用foo作为key获取存储值</span></span><br><span class="line"></span><br><span class="line">    client.set(<span class="string">'bar'</span>, <span class="string">'some value'</span>, err=&gt;&#123; <span class="comment">// 存储一个键为bar的值</span></span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err); <span class="comment">// 持久化到磁盘</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'write successful'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    client.del(<span class="string">'baz'</span>); <span class="comment">// 删除baz的值，回调函数可选</span></span><br><span class="line">    <span class="comment">// 删除时并不会将磁盘中的记录都删除，而用&#123;"key":"baz","value":null&#125;表示删除</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>Database模块继承自EventEmitter，并实现存储逻辑。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>).EventEmitter;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从EventEmitter继承</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Database</span> <span class="keyword">extends</span> <span class="title">EventEmitter</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(path)&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.path = path; <span class="comment">// 设置数据库路径</span></span><br><span class="line">        <span class="keyword">this</span>._records = <span class="built_in">Object</span>.create(<span class="literal">null</span>); <span class="comment">// 内存中所有记录的映射</span></span><br><span class="line">        <span class="comment">// 仅用于添加模式的写入流处理磁盘写入</span></span><br><span class="line">        <span class="keyword">this</span>._writeStream = fs.createWriteStream(<span class="keyword">this</span>.path,&#123;</span><br><span class="line">            encoding: <span class="string">'utf8'</span>,</span><br><span class="line">            flags: <span class="string">'a'</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">this</span>._load();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 存储流，并在完成后发出‘load’事件。</span></span><br><span class="line">    _load()&#123;</span><br><span class="line">        <span class="keyword">let</span> stream = fs.createReadStream(<span class="keyword">this</span>.path, &#123;<span class="attr">encoding</span>: <span class="string">'utf8'</span>&#125;);</span><br><span class="line">        <span class="keyword">let</span> database = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> data = <span class="string">''</span>;</span><br><span class="line">        stream.on(<span class="string">'readable'</span>, ()=&gt;&#123;</span><br><span class="line">            data += stream.read();  <span class="comment">// 读取可用数据</span></span><br><span class="line">            <span class="comment">// 由于按行分割，所以记录的最后是一个空字符串''需要将这个空字符串单独处理</span></span><br><span class="line">            <span class="keyword">let</span> records = data.split(<span class="string">'\n'</span>); <span class="comment">// 按行分割</span></span><br><span class="line">            data = records.pop(); <span class="comment">// 获取最后一个可能未完成的记录</span></span><br><span class="line"></span><br><span class="line">            records.forEach(<span class="function">(<span class="params">v, i, arr</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    v = <span class="built_in">JSON</span>.parse(v);</span><br><span class="line">                    <span class="keyword">if</span>(v.value == <span class="literal">null</span>)&#123;</span><br><span class="line">                        <span class="keyword">delete</span> database._records[v.key];</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        database._records[v.key] = v.value;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                    database.emit(<span class="string">'error'</span>, <span class="string">`found invalid recod:<span class="subst">$&#123;v&#125;</span>`</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        stream.on(<span class="string">'end'</span>, ()=&gt;&#123;</span><br><span class="line">            database.emit(<span class="string">'load'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get方法, 无key值则返回null</span></span><br><span class="line">    get(key)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._records[key] || <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set方法</span></span><br><span class="line">    set(key, value, cb)&#123;</span><br><span class="line">        <span class="comment">// 将key/value转为JSON字符串并添加换行</span></span><br><span class="line">        <span class="keyword">let</span> toWrite = <span class="built_in">JSON</span>.stringify(&#123;key, value&#125;) + <span class="string">'\n'</span>;</span><br><span class="line">        <span class="comment">// 根据value来决定是删除还是设置</span></span><br><span class="line">        <span class="keyword">if</span>(value == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">delete</span> <span class="keyword">this</span>._records[key];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">this</span>._records[key] = value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将记录写入磁盘，如有回调则执行回调</span></span><br><span class="line">        <span class="keyword">this</span>._writeStream.write(toWrite, cb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// del方法, 其实是set方法的语法糖</span></span><br><span class="line">    del(key, cb)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.set(key, <span class="literal">null</span>, cb);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Database;</span><br></pre></td></tr></table></figure></p>
<p>此简易数据库还有很多可优化的地方，比如<a href="http://mng.bz/2g19" target="_blank" rel="noopener">flushing writes</a>, 失败重试等。可以参考一些基于Node的完善的数据库模块，如<a href="https://github.com/felixge/node-dirty">node-dirty</a>, <a href="https://github.com/creationix/nstore">nstore</a></p>
<h3 id="技巧44-监视文件夹以及文件"><a href="#技巧44-监视文件夹以及文件" class="headerlink" title="技巧44 监视文件夹以及文件"></a>技巧44 监视文件夹以及文件</h3><p>有时候需要对文件或目录进行更改时执行一个操作，而Node对于文件监听有两个实现，分别是fs.watch和fs.watchFile。</p>
<p>其中fs.watch不是跨平台的，而fs.watchFile是，同时官方推荐尽可能使用fs.watch。其中两者到底区别在哪儿呢？</p>
<p><strong>fs.watch</strong><br>为了在单线程的环境中实现异步I/O，Node的事件轮询渗入操作系统中，提高了性能，同时操作系统能够让进程立即知道什么时候需要对新的I/O进行处理，至于通知进程的方式有多种，大都由libuv提供。实现文件监听的核心方法就是fs.watch。</p>
<p>其特性如下：</p>
<ul>
<li>更可靠，使得文件改变的事件总能被执行</li>
<li>更快，当事件发生时能够立即通过到Node进程</li>
</ul>
<p><strong>fs.watchFile</strong><br>此方法没有渗入到通知功能，而是在一个时间段内不停的轮询来看是否有文件发生改动。</p>
<p>fs.watchFile不快而且有明显弊端，但优势是跨平台，并且可以在网络文件系统（如SMB和NFS）上使用。</p>
<p>测试如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.watch(<span class="string">'./dir'</span>, <span class="built_in">console</span>.log);</span><br><span class="line">fs.watchFile(<span class="string">'./dir'</span>, <span class="built_in">console</span>.log);</span><br></pre></td></tr></table></figure></p>
<p>先创建一个dir目录，然后执行上述语句，然后在dir中新建一个文件test.file时，会输出：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">rename test.file</span><br><span class="line">Stats &#123;</span><br><span class="line">  dev: <span class="number">1923457940</span>,</span><br><span class="line">  mode: <span class="number">16822</span>,</span><br><span class="line">  nlink: <span class="number">1</span>,</span><br><span class="line">  uid: <span class="number">0</span>,</span><br><span class="line">  gid: <span class="number">0</span>,</span><br><span class="line">  rdev: <span class="number">0</span>,</span><br><span class="line">  blksize: <span class="literal">undefined</span>,</span><br><span class="line">  ino: <span class="number">16044073672540964</span>,</span><br><span class="line">  size: <span class="number">0</span>,</span><br><span class="line">  blocks: <span class="literal">undefined</span>,</span><br><span class="line">  atimeMs: <span class="number">1524624615998.3296</span>,</span><br><span class="line">  mtimeMs: <span class="number">1524624615998.3296</span>,</span><br><span class="line">  ctimeMs: <span class="number">1524624615998.3296</span>,</span><br><span class="line">  birthtimeMs: <span class="number">1524624572124.3838</span>,</span><br><span class="line">  atime: <span class="number">2018</span><span class="number">-04</span><span class="number">-25</span>T02:<span class="number">50</span>:<span class="number">15.998</span>Z,</span><br><span class="line">  mtime: <span class="number">2018</span><span class="number">-04</span><span class="number">-25</span>T02:<span class="number">50</span>:<span class="number">15.998</span>Z,</span><br><span class="line">  ctime: <span class="number">2018</span><span class="number">-04</span><span class="number">-25</span>T02:<span class="number">50</span>:<span class="number">15.998</span>Z,</span><br><span class="line">  birthtime: <span class="number">2018</span><span class="number">-04</span><span class="number">-25</span>T02:<span class="number">49</span>:<span class="number">32.124</span>Z</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当修改test.file文件时，会输出：<code>change test.file</code></p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2018/04/10/node-in-practice6/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            Newer
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2018/04/02/node-in-practice4/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>
    <!-- modified By KING 2017.11.16 -->
    <!-- Sidebar Avatar
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="KING's avatar">
    </div> -->

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        xmoyking@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="https://github.com/xmoyKing/xmoyKing.github.io" target="_blank" title="Star Me on GitHub">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">star</i>
                        
                        Star Me on GitHub
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                Home
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    Archives
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2018/04/">April 2018<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">March 2018<span class="sidebar_archives-count">17</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/02/">February 2018<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">January 2018<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">December 2017<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">November 2017<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">October 2017<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">September 2017<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">August 2017<span class="sidebar_archives-count">13</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">July 2017<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">June 2017<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">May 2017<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">April 2017<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">March 2017<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">February 2017<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">January 2017<span class="sidebar_archives-count">18</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">December 2016<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">November 2016<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">October 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">September 2016<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">August 2016<span class="sidebar_archives-count">20</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">July 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">June 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">May 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">April 2016<span class="sidebar_archives-count">5</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                Categories
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Angular/">Angular<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/categories/AngularJS/">AngularJS<span class="sidebar_archives-count">50</span></a></li><li><a class="sidebar_archives-link" href="/categories/CSS/">CSS<span class="sidebar_archives-count">26</span></a></li><li><a class="sidebar_archives-link" href="/categories/Java/">Java<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/JavaScript/">JavaScript<span class="sidebar_archives-count">93</span></a></li><li><a class="sidebar_archives-link" href="/categories/Linux/">Linux<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Nodejs/">Nodejs<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/categories/TypeScript/">TypeScript<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/WebApp/">WebApp<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/categories/jQuery/">jQuery<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/categories/linux/">linux<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/mixed/">mixed<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/categories/mongodb/">mongodb<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/python/">python<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/three-js/">three.js<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/区块链/">区块链<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/响应式-Web-设计/">响应式 Web 设计<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/安全/">安全<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/网络/">网络<span class="sidebar_archives-count">10</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="Tags">
                
                    <i class="material-icons sidebar-material-icons">bookmark</i>
                
                Tags
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
    
        <li>
            <a href="/2017/01/01/0_links/" title="Links">
                
                    <i class="material-icons sidebar-material-icons">polymer</i>
                
                Links
            </a>
        </li>
        
    
        <li>
            <a href="/2018/02/16/0_booklist/" title="Booklist">
                
                    <i class="material-icons sidebar-material-icons">code</i>
                
                Booklist
            </a>
        </li>
        
    
        <li>
            <a href="/2017/03/01/0_mixed/" title="Notes">
                
                    <i class="material-icons sidebar-material-icons">assignment</i>
                
                Notes
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                Number of articles
                <span class="sidebar-badge">261</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    
        <a href="https://plus.google.com/114920706759690760782" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    
        <a href="http://weibo.com/p/1005052419772155" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-weibo">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="http://github.com/xmoyking" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>KING · NOTE
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/lazyload.min.js", true)</script>



    <script>lsloader.load("js_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/js.min.js", true)</script>



    <script>lsloader.load("np_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/nprogress.js", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
