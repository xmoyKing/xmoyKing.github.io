<!DOCTYPE html>
<html style="display: none;" lang="en">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.0 -->
    <script>
        window.materialVersion = "1.5.0"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">

    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source"/>














    <!-- Title -->
    
    <title>
        
            JavaScript框架设计笔记-7-数据缓存系统 | 
        
        KING · NOTE
    </title>

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="KING">
    <meta name="description" itemprop="description" content="Loneliness is the carnival of one single soul.">
    <meta name="keywords" content=",js,js-framework">

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(window.oldVersion){var remove=window.oldVersion.reduce(function(p,c){return p||data.indexOf("/*"+c+"*/")!==-1},false);if(remove){lsloader.removeLS(key)}}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload,isJs){if(typeof cssonload==="boolean"){isJs=cssonload;cssonload=undefined}isJs=isJs||false;cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}code=code.split(versionString)[1];if(isJs){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload,isJs)}};lsloader.requestResource=function(name,path,cssonload,isJs){var that=this;if(isJs){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else{this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="KING · NOTE">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/css/material.min.css",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/css/style.min.css",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->
<!-- add By KING 2017.11.16 -->
<link rel="stylesheet" href="/css/highlightjs/vs.css">
<style>
  #scheme-Paradox .material-layout .highlight .meta{
    display: initial;
    padding: initial;
  }
</style>


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icon -->

    <style>
        @font-face {
            font-family: 'Material Icons';
            font-style: normal;
            font-weight: 400;
            src: local('Material Icons'),
            local('MaterialIcons-Regular'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.woff2) format('woff2'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.woff) format('woff'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.ttf) format('truetype');
        }
    </style>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/jquery.min.js", true)</script>
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="https://github.com/xmoyKING">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="JavaScript框架设计笔记-7-数据缓存系统 | KING · NOTE">
    <meta property="og:image" content="https://github.com/xmoyKING/img/favicon.png" />
    <meta property="og:description" content="Loneliness is the carnival of one single soul.">
    <meta property="og:article:tag" content="js"> <meta property="og:article:tag" content="js-framework"> 

    
        <meta property="article:published_time" content="Sat Dec 30 2017 15:24:04 GMT+0800" />
        <meta property="article:modified_time" content="Sat Dec 30 2017 15:24:04 GMT+0800" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="JavaScript框架设计笔记-7-数据缓存系统 | KING · NOTE">
    <meta name="twitter:description" content="Loneliness is the carnival of one single soul.">
    <meta name="twitter:image" content="https://github.com/xmoyKING/img/favicon.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://github.com/xmoyKING" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="https://github.com/xmoyKING/2017/12/30/js-framework7/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "https://github.com/xmoyKING/2017/12/30/js-framework7/index.html",
    "headline": "JavaScript框架设计笔记-7-数据缓存系统",
    "datePublished": "Sat Dec 30 2017 15:24:04 GMT+0800",
    "dateModified": "Sat Dec 30 2017 15:24:04 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "KING",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": "Loneliness is the carnival of one single soul."
    },
    "publisher": {
        "@type": "Organization",
        "name": "KING · NOTE",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",js,js-framework",
    "description": "Loneliness is the carnival of one single soul.",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#jQuery第一代缓存系统"><span class="post-toc-number">1.</span> <span class="post-toc-text">jQuery第一代缓存系统</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#jQuery第二代缓存系统"><span class="post-toc-number">2.</span> <span class="post-toc-text">jQuery第二代缓存系统</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#mass-Framework第一代缓存系统"><span class="post-toc-number">3.</span> <span class="post-toc-text">mass Framework第一代缓存系统</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#mass-Framework第二代缓存系统"><span class="post-toc-number">4.</span> <span class="post-toc-text">mass Framework第二代缓存系统</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#mass-Framework第三代缓存系统"><span class="post-toc-number">5.</span> <span class="post-toc-text">mass Framework第三代缓存系统</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                JavaScript框架设计笔记-7-数据缓存系统
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>KING</strong>
        <span>Dec 30, 2017</span>
        <!-- Updated Time , add By KING 2017.11.16 -->
        <span>Dec 30, 2017 UPDATED</span> 
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/js/">js</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/js-framework/">js-framework</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=JavaScript框架设计笔记-7-数据缓存系统&url=https://github.com/xmoyKING/2017/12/30/js-framework7/index.html&pic=https://github.com/xmoyKING/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                Share to Weibo
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=JavaScript框架设计笔记-7-数据缓存系统&url=https://github.com/xmoyKING/2017/12/30/js-framework7/index.html&via=KING" target="_blank">
            <li class="mdl-menu__item">
                Share to Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://github.com/xmoyKING/2017/12/30/js-framework7/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=https://github.com/xmoyKING/2017/12/30/js-framework7/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>数据缓存系统最早应该是jquery1.2引入的，它是用来关联操作对象和与之相关的数据的一种机制。通常在DOM中操作3种数据，元素节点、文档对象、window对象。数据缓存系统能够规避循环引用的问题以及全局污染问题，（即事件的回调都放到一个EventTarget之上时会引发循环引用问题，当EventTarget是一个window对象时会引发全局污染问题），同时能够有效保存不同方法产生的中间变量，当这些中间变量对另一个模块的方法有用时，能解耦方法间的依赖。</p>
<p>对于后期的jquery，事件克隆、事件队列都离不开缓存系统，缓存系统主要分为4种形态：</p>
<ol>
<li>属性标记法</li>
<li>数组索引法</li>
<li>valueOf重写法</li>
<li>WeakMap关联法</li>
</ol>
<h4 id="jQuery第一代缓存系统"><a href="#jQuery第一代缓存系统" class="headerlink" title="jQuery第一代缓存系统"></a>jQuery第一代缓存系统</h4><p>jquery1.2在core模块新增了两个静态方法，data与removeData。data读写结合，jquery的缓存系统把所有的数据都放在$.cache仓库上，然后为每个要使用缓存系统的元素节点、文档对象、window对象分配一个UUID。</p>
<p>UUID的属性名为一个随机的自定义属性，<code>&#39;jQuery&#39;+(new Date()).getTime()</code>,值为整数，从零递增。但UUID总要附于一个对象上，当对象是window时，就会引发全局污染。因此jquery内部判断当对象为window时，则将其自动映射到windowData的空对象上，然后在windowData上附加UUID，有了UUID，在首次访问缓存系统时，就会在$.cache对象开辟一个空对象（缓存体），用于放置与目标对象有关的东西。removeData则会删除掉不再需要保存的数据，若到最后数据清除完了，没有任何键值对了，则成为一个空对象，此时jquery就从$.cahce中删掉此对象，并从目标对象移除UUID。</p>
<p>jquery1.2.3添加了两个同名的原型方法data与removeData，目的是方便链式操作与集化操作，并在data中添加getData、setData的自定义事件的触发逻辑。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jquery1.2.3</span></span><br><span class="line"><span class="keyword">var</span> expando = <span class="string">'jQuery'</span>+(<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime(),</span><br><span class="line">  uuid = <span class="number">0</span>,</span><br><span class="line">  windowData = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">jQuery.extend(&#123;</span><br><span class="line">  cache: &#123;&#125;,</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span>(<span class="params">elem, name, data</span>)</span>&#123;</span><br><span class="line">    elem = elem == <span class="built_in">window</span> ? windowData : elem; <span class="comment">// 对window对象进行处理</span></span><br><span class="line">    <span class="keyword">var</span> id = elem[expando];</span><br><span class="line">    <span class="keyword">if</span>(!id)&#123; <span class="comment">// 若没有UUID，则新建一个</span></span><br><span class="line">      id = elem[expando] = ++uuid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 若没有在$.cache中，则先新建</span></span><br><span class="line">    <span class="keyword">if</span>(name &amp;&amp; !jQuery.cache[id])&#123;</span><br><span class="line">      jQuery.cache[id] = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 第三个参数不为undefined时为写操作</span></span><br><span class="line">    <span class="keyword">if</span>(data != <span class="literal">undefined</span>)&#123;</span><br><span class="line">      jQuery.cache[id][name] = data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 若只有一个参数，则返回缓存对象，两个参数则返回目标数据</span></span><br><span class="line">    <span class="keyword">return</span> name ? jQuery.cache[id][name] : id;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  removeData: <span class="function"><span class="keyword">function</span>(<span class="params">elem, name</span>)</span>&#123;</span><br><span class="line">    elem = elem == <span class="built_in">window</span> ? windowData : elem;</span><br><span class="line">    <span class="keyword">var</span> id = elem[expando];</span><br><span class="line">    <span class="keyword">if</span>(name)&#123;<span class="comment">// 移除目标数据</span></span><br><span class="line">      <span class="keyword">if</span>(jQuery.cache[id])&#123;</span><br><span class="line">        <span class="keyword">delete</span> jQuery.cache[id][id];</span><br><span class="line">        name = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(name <span class="keyword">in</span> jQuery.cache[id])&#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 遍历缓存体，若不为空则改写name，若没有被改写，则!name为true</span></span><br><span class="line">        <span class="comment">// 从而引发再次调用此方法，此时只传入一个参数，移除缓存体</span></span><br><span class="line">        <span class="keyword">if</span>(!name)&#123;</span><br><span class="line">          jQuery.removeData(elem);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 移除UUID，但IE下对元素使用delete会抛错</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">          <span class="keyword">delete</span> elem[expando];</span><br><span class="line">        &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">          <span class="keyword">if</span>(elem.removeAttribute)&#123;</span><br><span class="line">            elem.removeAttribute(expando);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 注销cache</span></span><br><span class="line">        <span class="keyword">delete</span> jQuery.cache[id];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>jquery1.3中，数据缓存系统独立成为一个data模块（内部划分使用），并在原型和命名空间中添加queue和dequeue方法。queue的作用是缓存一组数据，为动画模块服务，dequeue是从一组数据中删掉一个。</p>
<p>在元素上添加自定义属性时会引发一个问题，即对元素进行复制时会将此属性也复制过去，导致两个元素有相同的UUID值。jquery早期的解决方法为若元素cloneNode方法不会复制事件就使用cloneNode，否则使用元素的outerHTML或父节点的innerHTML，用clean方法解析一个新元素出来，然后用正则清除掉所有新元素上的显式属性。</p>
<p>jquery1.4中，对object、embed、applet进行特殊处理，因为这3个元素用于加载外部资源，在旧版IE中，元素节点是COM的包装，引入外部资源后就会变为资源的实例，可能会引发其他错误，所以对这三种元素不进行缓存处理。jquery1.4对$.data改进，允许第二个参数为对象，方便存储多个数据，UUID对应的自定义属性expando放入到命名控件下，queue和dequeue方法成为一个新模块。</p>
<p>面对自定义属性，H5有一种<code>data-*</code>的缓存机制，当用户设置的属性以data-开头，它们就会被保存到元素节点的dataset对象上，于是jquery允许人们通过设置<code>data-*</code>来配置UI组件，当用户第一次访问次元素节点，会遍历它所有data-开头的自定义属性，将它们放到jquery缓存中，用用户取数据时，优先从缓存系统中取，没有在使用setAttribute访问data-自定义属性，同时jquery还增强了这种data-缓存机制（H5只能保存字符串），会将其内数据还原为原始类型，如’null’还原为<code>null</code>,’false’还原为<code>false</code>，包裹在<code>{}</code>中的数据则尝试转换为一个对象。</p>
<p>jquery1.5着重改进性能（1.4打败了Prototype.js,用户暴增）,改进expand为基于版本号+随机数，因为用户可能在一个页面内引入多个版本的jquery。<br>是否有自定义数据的逻辑抽离为hasData方法，处理H5的<code>data-*</code>属性抽离为dataAttr内部方法。<br>jquery的数据缓存系统原本是为事件系统服务而分化出来的，到后来，成为内部众多模块的基础，而一旦公开到文档中，用户就可以用data方法来保存用户数据，因此用户数据和内部私有数据可能会有相互覆盖的问题，最后的解决方法是对缓存体进行改造，原本是一个对象，什么都能装，改为在内部开辟一个子对象，键名为随机的jQuery.expando值，若是私有数据就存到子对象里。events私有数据出于兼容目的，直接放到缓存体上。 区分私有数据的方式就是直接在data方法上添加第四个参数，真值为私有数据，removeData也提供第三个参数，用于删除私有数据，同时新设一个_data方法，专门用于操作私有数据。</p>
<p>jquery1.7改进为系统变量放在data对象中。</p>
<p>jquery1.8将UUID值改用jQuery.guid递增生成。</p>
<h4 id="jQuery第二代缓存系统"><a href="#jQuery第二代缓存系统" class="headerlink" title="jQuery第二代缓存系统"></a>jQuery第二代缓存系统</h4><p>目标如下：</p>
<ol>
<li>在接口与语义上兼容1.9.x分支</li>
<li>通过简化存储路径为统一的方法来提高维护性</li>
<li>使用相同的机制来实现私有和用户数据</li>
<li>不再把私有数据与用户数据混在一起</li>
<li>不再在用户对象上添加自定义属性</li>
<li>方便以后可以平滑的利用WeakMap对象进行升级</li>
</ol>
<p>第二代缓存系统的实现方法是valueOf重写，具体原理为：若目标对象的valueOf传入一个特殊的对象，那么它就返回一个UUID，然后通过UUID在Data实例的cache对象属性上开辟缓存，这样就不需要使用windowData来代替window了，也无需在意IE下embed、object、applet等特殊元素了。</p>
<p>第二代在框架内部添加Data类，它的实例有cache属性，私有数据与用户数据分别由一个Data实例来维护。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Data</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.cache = &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Data.uid = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">Data.prototype = &#123;</span><br><span class="line">    locker: <span class="function"><span class="keyword">function</span>(<span class="params">owner</span>)</span>&#123; <span class="comment">// owner为元素节点、文档对象、window对象</span></span><br><span class="line">        <span class="comment">// 首先检查它们的valueOf方法是否被重写过</span></span><br><span class="line">        <span class="comment">// 对构造器进行原型重写成本太大，转而为每一个实例的valueOf方法进行重写</span></span><br><span class="line">        <span class="comment">// 检测方式为传入Data类，若返回object说明没有被重写，返回string则已被重写</span></span><br><span class="line">        <span class="comment">// 这个字符串就是UUID，用于在缓存仓库创建缓存体</span></span><br><span class="line">        <span class="keyword">var</span> ovalueOf,</span><br><span class="line">            unlock = owner.valueOf(Data);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重写使用Object.defineProperty方法</span></span><br><span class="line">        <span class="comment">// 其第三个参数为对象，若不显示设置enumerable、writable、configurable</span></span><br><span class="line">        <span class="comment">// 则默认设置false，这个过程被jquery称为开锁</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> unlock !== <span class="string">'string'</span>)&#123;</span><br><span class="line">            unlock = jQuery.expando + Data.uid++;</span><br><span class="line">            ovalueOf = owner.valueOf;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">Object</span>.defineProperty(owner, <span class="string">'valueOf'</span>, &#123;</span><br><span class="line">                value: <span class="function"><span class="keyword">function</span>(<span class="params">pick</span>)</span>&#123;</span><br><span class="line">                    <span class="keyword">if</span>(pick === Data)&#123;</span><br><span class="line">                        <span class="keyword">return</span> unlock;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> ovalueOf.apply(owner);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 接下来开辟缓存体</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">this</span>.cache[unlock])&#123;</span><br><span class="line">            <span class="keyword">this</span>.cache[unlock] = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> unlock;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    set: <span class="function"><span class="keyword">function</span>(<span class="params">owner, data, value</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 写方法</span></span><br><span class="line">        <span class="keyword">var</span> prop, cache, unlock;</span><br><span class="line">        <span class="comment">// UUID和缓存体</span></span><br><span class="line">        unlock = <span class="keyword">this</span>.locker(owner);</span><br><span class="line">        cache = <span class="keyword">this</span>.cache[unlock];</span><br><span class="line">        <span class="comment">// 若传入value，第2个为从字符串，则表示添加新键值对</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> data === <span class="string">'string'</span>)&#123;</span><br><span class="line">            cache[data] = value;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 传入2个参数，第二个为对象</span></span><br><span class="line">            <span class="comment">// 若缓存体没有添加过任何对象，则直接赋值，否则使用for in循环添加</span></span><br><span class="line">            <span class="keyword">if</span>(jQuery.isEmptyObject(cache))&#123;</span><br><span class="line">                cache = data;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">for</span>(prop <span class="keyword">in</span> data)&#123;</span><br><span class="line">                    cache[prop] = data[prop];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.cache[unlock] = cache;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    get: <span class="function"><span class="keyword">function</span>(<span class="params">owner, key</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 读方法</span></span><br><span class="line">        <span class="keyword">var</span> cache = <span class="keyword">this</span>.cache[<span class="keyword">this</span>.locker(owner)];</span><br><span class="line">        <span class="comment">// 若只有一个参数，则返回整个缓存体</span></span><br><span class="line">        <span class="keyword">return</span> key === <span class="literal">undefined</span> ? cache : cache[key];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    access: <span class="function"><span class="keyword">function</span>(<span class="params">owner, key, value</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 决定是读还是写</span></span><br><span class="line">        <span class="keyword">if</span>(key === <span class="literal">undefined</span> || ((key &amp;&amp; <span class="keyword">typeof</span> key === <span class="string">'string'</span>) &amp;&amp; value === <span class="literal">undefined</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.get(owner, key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.set(owner, key, value);</span><br><span class="line">        <span class="keyword">return</span> value !== <span class="literal">undefined</span> ? value : key;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    remove: <span class="function"><span class="keyword">function</span>(<span class="params">owner, key</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 删除和第一代类似，略</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    hasData: <span class="function"><span class="keyword">function</span>(<span class="params">owner</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 判断是否缓存了数据</span></span><br><span class="line">        <span class="keyword">return</span> !jQuery.isEmptyObject(<span class="keyword">this</span>.cache[<span class="keyword">this</span>.locker(owner)]);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    discard: <span class="function"><span class="keyword">function</span>(<span class="params">owner</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 删除owner相关的用户数据和私有数据</span></span><br><span class="line">        <span class="keyword">delete</span> <span class="keyword">this</span>.cache[<span class="keyword">this</span>.locker(owner)];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data_user = <span class="keyword">new</span> Data(),</span><br><span class="line">    data_priv = <span class="keyword">new</span> Data();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">data_discard</span>(<span class="params">owner</span>)</span>&#123;</span><br><span class="line">    data_user.discard(owner);</span><br><span class="line">    data_priv.discard(owner);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接下来暴露给用户调用的都是空壳，用来转交给data_user、data_priv这两个实例对象处理，</span></span><br><span class="line"><span class="comment">// 并且私有数据的处理也不通过用户数据的渠道了</span></span><br><span class="line">jQuery.extend(&#123;</span><br><span class="line">    <span class="comment">// UUID</span></span><br><span class="line">    expando: <span class="string">'jQuery'</span>+(core_version+<span class="built_in">Math</span>.random()).replace(<span class="regexp">/\D/g</span>, <span class="string">''</span>),</span><br><span class="line">    <span class="comment">// 用于向前兼容</span></span><br><span class="line">    acceptData: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    hasData: <span class="function"><span class="keyword">function</span>(<span class="params">elem</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data_user.hasData(elem) || data_priv.hasData(elem);</span><br><span class="line">    &#125;,</span><br><span class="line">    data: <span class="function"><span class="keyword">function</span>(<span class="params">elem, name, data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data_user.access(elem, name, data);</span><br><span class="line">    &#125;,</span><br><span class="line">    removeData: <span class="function"><span class="keyword">function</span>(<span class="params">elem, name</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data_user.remove(elem, name);</span><br><span class="line">    &#125;,</span><br><span class="line">    _data: <span class="function"><span class="keyword">function</span>(<span class="params">elem, name, data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data_priv.access(elem, name, data);</span><br><span class="line">    &#125;,</span><br><span class="line">    _removeData: <span class="function"><span class="keyword">function</span>(<span class="params">elem, name</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data_priv.remove(elem, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>重写valueOf非常好，任何非纯空对象都有valueOf方法，通过闭包保存用于关联缓存仓库的UUID，但缺点是闭包非常耗内存。</p>
<h4 id="mass-Framework第一代缓存系统"><a href="#mass-Framework第一代缓存系统" class="headerlink" title="mass Framework第一代缓存系统"></a>mass Framework第一代缓存系统</h4><p>mass Framework兼容jquery 90%的API，也存在数据缓存系统，改良自jquery，其关联方式不同。</p>
<p>为了建立目标对象与缓存体的联系，jquery选择目标对象上添加自定义属性，但旧版IE有特殊元素的问题，而mass Framework通过uniqueNumber属性（IE的私有属性）来解决。</p>
<h4 id="mass-Framework第二代缓存系统"><a href="#mass-Framework第二代缓存系统" class="headerlink" title="mass Framework第二代缓存系统"></a>mass Framework第二代缓存系统</h4><p>属性标记法的缺点就是需要根据目标对象的不同或浏览器的不同做出不同的处理，且清理这些自定义属性非常麻烦，jquery第二代缓存系统采用空间换时间的方式将UUID内嵌到目标对象的valueOf方法中。mass Framework第二代采用数组索引法，建立两个数组，一个装目标对象，另一个数组在对应的位置上放缓存体，这样就不用对目标对象做任何修改，从而目标对象可以扩展到任何数据类型，并且即使目标对象使用了Object.preventExtensions、Object.seal、Object.freeze也可以得到UUID。</p>
<h4 id="mass-Framework第三代缓存系统"><a href="#mass-Framework第三代缓存系统" class="headerlink" title="mass Framework第三代缓存系统"></a>mass Framework第三代缓存系统</h4><p>WeakMap是ES6带来的新集合对象，其特性刚好适合缓存系统的要求。所以利用WeakMap代替UUID做为目标对象和缓存体的联系，实在是一件在适合不过的事儿了。</p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2018/01/02/js-framework8/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            Newer
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/12/26/js-framework6/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>
    <!-- modified By KING 2017.11.16 -->
    <!-- Sidebar Avatar
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="KING's avatar">
    </div> -->

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        xmoyking@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="https://github.com/xmoyKing/xmoyKing.github.io" target="_blank" title="Star Me on GitHub">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">star</i>
                        
                        Star Me on GitHub
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                Home
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    Archives
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2018/01/">January 2018<span class="sidebar_archives-count">20</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">December 2017<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">November 2017<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">October 2017<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">September 2017<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">August 2017<span class="sidebar_archives-count">13</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">July 2017<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">June 2017<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">May 2017<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">April 2017<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">March 2017<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">February 2017<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">January 2017<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">November 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">October 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">September 2016<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">August 2016<span class="sidebar_archives-count">20</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                Categories
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Angular/">Angular<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/categories/Nodejs/">Nodejs<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/categories/Translation/">Translation<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/TypeScript/">TypeScript<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/WebApp/">WebApp<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/categories/angularjs/">angularjs<span class="sidebar_archives-count">50</span></a></li><li><a class="sidebar_archives-link" href="/categories/css/">css<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/categories/java/">java<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/js/">js<span class="sidebar_archives-count">89</span></a></li><li><a class="sidebar_archives-link" href="/categories/linux/">linux<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/categories/mixed/">mixed<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/categories/mongodb/">mongodb<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/python/">python<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/three-js/">three.js<span class="sidebar_archives-count">2</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="Tags">
                
                    <i class="material-icons sidebar-material-icons">bookmark</i>
                
                Tags
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
    
        <li>
            <a href="/about/links.html" title="Links">
                
                    <i class="material-icons sidebar-material-icons">polymer</i>
                
                Links
            </a>
        </li>
        
    
        <li>
            <a href="http://www.filmboard.cn" title="Works">
                
                    <i class="material-icons sidebar-material-icons">code</i>
                
                Works
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                Number of articles
                <span class="sidebar-badge">214</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    
        <a href="https://plus.google.com/114920706759690760782" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    
        <a href="http://weibo.com/p/1005052419772155" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-weibo">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="http://github.com/xmoyking" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>KING · NOTE
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/lazyload.min.js", true)</script>



    <script>lsloader.load("js_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/js.min.js", true)</script>



    <script>lsloader.load("np_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/nprogress.js", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
