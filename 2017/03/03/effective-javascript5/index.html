<!DOCTYPE html>
<html style="display: none;" lang="en">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.0 -->
    <script>
        window.materialVersion = "1.5.0"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">

    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source"/>














    <!-- Title -->
    
    <title>
        
            effective-javascript笔记-5 | 
        
        KING · NOTE
    </title>

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="KING">
    <meta name="description" itemprop="description" content="Loneliness is the carnival of one single soul.">
    <meta name="keywords" content="null,js,effective-javascript,note">

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(window.oldVersion){var remove=window.oldVersion.reduce(function(p,c){return p||data.indexOf("/*"+c+"*/")!==-1},false);if(remove){lsloader.removeLS(key)}}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload,isJs){if(typeof cssonload==="boolean"){isJs=cssonload;cssonload=undefined}isJs=isJs||false;cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}code=code.split(versionString)[1];if(isJs){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload,isJs)}};lsloader.requestResource=function(name,path,cssonload,isJs){var that=this;if(isJs){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else{this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="KING · NOTE">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/css/material.min.css",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/css/style.min.css",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->
<!-- add By KING 2017.11.16 -->
<link rel="stylesheet" href="/css/highlightjs/vs.css">
<style>
  #scheme-Paradox .material-layout .highlight .meta{
    display: initial;
    padding: initial;
  }
</style>


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icon -->

    <style>
        @font-face {
            font-family: 'Material Icons';
            font-style: normal;
            font-weight: 400;
            src: local('Material Icons'),
            local('MaterialIcons-Regular'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.woff2) format('woff2'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.woff) format('woff'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.ttf) format('truetype');
        }
    </style>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/jquery.min.js", true)</script>
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="https://github.com/xmoyKING">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="effective-javascript笔记-5 | KING · NOTE">
    <meta property="og:image" content="https://github.com/xmoyKING/img/favicon.png" />
    <meta property="og:description" content="Loneliness is the carnival of one single soul.">
    <meta property="og:article:tag" content="js"> <meta property="og:article:tag" content="effective-javascript"> <meta property="og:article:tag" content="note"> 

    
        <meta property="article:published_time" content="Fri Mar 03 2017 16:45:45 GMT+0800" />
        <meta property="article:modified_time" content="Sat Mar 25 2017 00:00:00 GMT+0800" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="effective-javascript笔记-5 | KING · NOTE">
    <meta name="twitter:description" content="Loneliness is the carnival of one single soul.">
    <meta name="twitter:image" content="https://github.com/xmoyKING/img/favicon.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://github.com/xmoyKING" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="https://github.com/xmoyKING/2017/03/03/effective-javascript5/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "https://github.com/xmoyKING/2017/03/03/effective-javascript5/index.html",
    "headline": "effective-javascript笔记-5",
    "datePublished": "Fri Mar 03 2017 16:45:45 GMT+0800",
    "dateModified": "Sat Mar 25 2017 00:00:00 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "KING",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": "Loneliness is the carnival of one single soul."
    },
    "publisher": {
        "@type": "Organization",
        "name": "KING · NOTE",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",js,effective-javascript,notenull",
    "description": "Loneliness is the carnival of one single soul.",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#数组和字典"><span class="post-toc-number">1.</span> <span class="post-toc-text"><a href="#&#x6570;&#x7EC4;&#x548C;&#x5B57;&#x5178;" class="headerlink" title="&#x6570;&#x7EC4;&#x548C;&#x5B57;&#x5178;"></a>&#x6570;&#x7EC4;&#x548C;&#x5B57;&#x5178;</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#43-使用Object的直接实例构造轻量级字典"><span class="post-toc-number">1.1.</span> <span class="post-toc-text"><a href="#43-&#x4F7F;&#x7528;Object&#x7684;&#x76F4;&#x63A5;&#x5B9E;&#x4F8B;&#x6784;&#x9020;&#x8F7B;&#x91CF;&#x7EA7;&#x5B57;&#x5178;" class="headerlink" title="43. &#x4F7F;&#x7528;Object&#x7684;&#x76F4;&#x63A5;&#x5B9E;&#x4F8B;&#x6784;&#x9020;&#x8F7B;&#x91CF;&#x7EA7;&#x5B57;&#x5178;"></a>43. &#x4F7F;&#x7528;Object&#x7684;&#x76F4;&#x63A5;&#x5B9E;&#x4F8B;&#x6784;&#x9020;&#x8F7B;&#x91CF;&#x7EA7;&#x5B57;&#x5178;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#44-使用null原型防止原型污染"><span class="post-toc-number">1.2.</span> <span class="post-toc-text"><a href="#44-&#x4F7F;&#x7528;null&#x539F;&#x578B;&#x9632;&#x6B62;&#x539F;&#x578B;&#x6C61;&#x67D3;" class="headerlink" title="44. &#x4F7F;&#x7528;null&#x539F;&#x578B;&#x9632;&#x6B62;&#x539F;&#x578B;&#x6C61;&#x67D3;"></a>44. &#x4F7F;&#x7528;null&#x539F;&#x578B;&#x9632;&#x6B62;&#x539F;&#x578B;&#x6C61;&#x67D3;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#45-使用hasOwnProperty方法以避免原型污染"><span class="post-toc-number">1.3.</span> <span class="post-toc-text"><a href="#45-&#x4F7F;&#x7528;hasOwnProperty&#x65B9;&#x6CD5;&#x4EE5;&#x907F;&#x514D;&#x539F;&#x578B;&#x6C61;&#x67D3;" class="headerlink" title="45. &#x4F7F;&#x7528;hasOwnProperty&#x65B9;&#x6CD5;&#x4EE5;&#x907F;&#x514D;&#x539F;&#x578B;&#x6C61;&#x67D3;"></a>45. &#x4F7F;&#x7528;hasOwnProperty&#x65B9;&#x6CD5;&#x4EE5;&#x907F;&#x514D;&#x539F;&#x578B;&#x6C61;&#x67D3;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#46-使用数组而不是使用字典来存储有序集合"><span class="post-toc-number">1.4.</span> <span class="post-toc-text"><a href="#46-&#x4F7F;&#x7528;&#x6570;&#x7EC4;&#x800C;&#x4E0D;&#x662F;&#x4F7F;&#x7528;&#x5B57;&#x5178;&#x6765;&#x5B58;&#x50A8;&#x6709;&#x5E8F;&#x96C6;&#x5408;" class="headerlink" title="46. &#x4F7F;&#x7528;&#x6570;&#x7EC4;&#x800C;&#x4E0D;&#x662F;&#x4F7F;&#x7528;&#x5B57;&#x5178;&#x6765;&#x5B58;&#x50A8;&#x6709;&#x5E8F;&#x96C6;&#x5408;"></a>46. &#x4F7F;&#x7528;&#x6570;&#x7EC4;&#x800C;&#x4E0D;&#x662F;&#x4F7F;&#x7528;&#x5B57;&#x5178;&#x6765;&#x5B58;&#x50A8;&#x6709;&#x5E8F;&#x96C6;&#x5408;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#47-绝不要在Object-prototype中增加可枚举的属性"><span class="post-toc-number">1.5.</span> <span class="post-toc-text"><a href="#47-&#x7EDD;&#x4E0D;&#x8981;&#x5728;Object-prototype&#x4E2D;&#x589E;&#x52A0;&#x53EF;&#x679A;&#x4E3E;&#x7684;&#x5C5E;&#x6027;" class="headerlink" title="47. &#x7EDD;&#x4E0D;&#x8981;&#x5728;Object.prototype&#x4E2D;&#x589E;&#x52A0;&#x53EF;&#x679A;&#x4E3E;&#x7684;&#x5C5E;&#x6027;"></a>47. &#x7EDD;&#x4E0D;&#x8981;&#x5728;Object.prototype&#x4E2D;&#x589E;&#x52A0;&#x53EF;&#x679A;&#x4E3E;&#x7684;&#x5C5E;&#x6027;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#48-避免在枚举期间修改对象"><span class="post-toc-number">1.6.</span> <span class="post-toc-text"><a href="#48-&#x907F;&#x514D;&#x5728;&#x679A;&#x4E3E;&#x671F;&#x95F4;&#x4FEE;&#x6539;&#x5BF9;&#x8C61;" class="headerlink" title="48. &#x907F;&#x514D;&#x5728;&#x679A;&#x4E3E;&#x671F;&#x95F4;&#x4FEE;&#x6539;&#x5BF9;&#x8C61;"></a>48. &#x907F;&#x514D;&#x5728;&#x679A;&#x4E3E;&#x671F;&#x95F4;&#x4FEE;&#x6539;&#x5BF9;&#x8C61;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#49-数组迭代优先选择for循环-而不是for-in循环"><span class="post-toc-number">1.7.</span> <span class="post-toc-text"><a href="#49-&#x6570;&#x7EC4;&#x8FED;&#x4EE3;&#x4F18;&#x5148;&#x9009;&#x62E9;for&#x5FAA;&#x73AF;-&#x800C;&#x4E0D;&#x662F;for-in&#x5FAA;&#x73AF;" class="headerlink" title="49. &#x6570;&#x7EC4;&#x8FED;&#x4EE3;&#x4F18;&#x5148;&#x9009;&#x62E9;for&#x5FAA;&#x73AF;,&#x800C;&#x4E0D;&#x662F;for in&#x5FAA;&#x73AF;"></a>49. &#x6570;&#x7EC4;&#x8FED;&#x4EE3;&#x4F18;&#x5148;&#x9009;&#x62E9;for&#x5FAA;&#x73AF;,&#x800C;&#x4E0D;&#x662F;for in&#x5FAA;&#x73AF;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#50-迭代方法优于循环"><span class="post-toc-number">1.8.</span> <span class="post-toc-text"><a href="#50-&#x8FED;&#x4EE3;&#x65B9;&#x6CD5;&#x4F18;&#x4E8E;&#x5FAA;&#x73AF;" class="headerlink" title="50. &#x8FED;&#x4EE3;&#x65B9;&#x6CD5;&#x4F18;&#x4E8E;&#x5FAA;&#x73AF;"></a>50. &#x8FED;&#x4EE3;&#x65B9;&#x6CD5;&#x4F18;&#x4E8E;&#x5FAA;&#x73AF;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#51-在类数组对象上复用通用的数组方法"><span class="post-toc-number">1.9.</span> <span class="post-toc-text"><a href="#51-&#x5728;&#x7C7B;&#x6570;&#x7EC4;&#x5BF9;&#x8C61;&#x4E0A;&#x590D;&#x7528;&#x901A;&#x7528;&#x7684;&#x6570;&#x7EC4;&#x65B9;&#x6CD5;" class="headerlink" title="51. &#x5728;&#x7C7B;&#x6570;&#x7EC4;&#x5BF9;&#x8C61;&#x4E0A;&#x590D;&#x7528;&#x901A;&#x7528;&#x7684;&#x6570;&#x7EC4;&#x65B9;&#x6CD5;"></a>51. &#x5728;&#x7C7B;&#x6570;&#x7EC4;&#x5BF9;&#x8C61;&#x4E0A;&#x590D;&#x7528;&#x901A;&#x7528;&#x7684;&#x6570;&#x7EC4;&#x65B9;&#x6CD5;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#52-数组字面量优于数组构造函数"><span class="post-toc-number">1.10.</span> <span class="post-toc-text"><a href="#52-&#x6570;&#x7EC4;&#x5B57;&#x9762;&#x91CF;&#x4F18;&#x4E8E;&#x6570;&#x7EC4;&#x6784;&#x9020;&#x51FD;&#x6570;" class="headerlink" title="52. &#x6570;&#x7EC4;&#x5B57;&#x9762;&#x91CF;&#x4F18;&#x4E8E;&#x6570;&#x7EC4;&#x6784;&#x9020;&#x51FD;&#x6570;"></a>52. &#x6570;&#x7EC4;&#x5B57;&#x9762;&#x91CF;&#x4F18;&#x4E8E;&#x6570;&#x7EC4;&#x6784;&#x9020;&#x51FD;&#x6570;</span></a></li></ol></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                effective-javascript笔记-5
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>KING</strong>
        <span>Mar 03, 2017</span>
        <!-- Updated Time , add By KING 2017.11.16 -->
        <span>Mar 25, 2017 UPDATED</span> 
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/effective-javascript/">effective-javascript</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/js/">js</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/note/">note</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=effective-javascript笔记-5&url=https://github.com/xmoyKING/2017/03/03/effective-javascript5/index.html&pic=https://github.com/xmoyKING/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                Share to Weibo
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=effective-javascript笔记-5&url=https://github.com/xmoyKING/2017/03/03/effective-javascript5/index.html&via=KING" target="_blank">
            <li class="mdl-menu__item">
                Share to Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://github.com/xmoyKING/2017/03/03/effective-javascript5/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=https://github.com/xmoyKING/2017/03/03/effective-javascript5/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h2 id="数组和字典"><a href="#数组和字典" class="headerlink" title="数组和字典"></a>数组和字典</h2><p>将对象作为集合的用法</p>
<h3 id="43-使用Object的直接实例构造轻量级字典"><a href="#43-使用Object的直接实例构造轻量级字典" class="headerlink" title="43. 使用Object的直接实例构造轻量级字典"></a>43. 使用Object的直接实例构造轻量级字典</h3><p>JS对象的一个核心是一个字符串属性名称与属性值的映射表. 可以通过<code>for in</code>循环枚举对象属性名.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dict = &#123;<span class="attr">alice</span>: <span class="number">34</span>, <span class="attr">bob</span>: <span class="number">24</span>, <span class="attr">chris</span>: <span class="number">62</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> people = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> dict)&#123;</span><br><span class="line">    people.push(name+<span class="string">': '</span>+ dict[name]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">people; <span class="comment">// ["alice: 34",  "bob: 24", "chris: 62"]</span></span><br></pre></td></tr></table></figure></p>
<p>但<code>for in</code>循环除了枚举自身的属性外,还会枚举继承过来的属性.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NaiveDict</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">NaiveDict.prototype.count = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> <span class="keyword">this</span>)&#123;</span><br><span class="line">        ++i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">NaiveDict.prototype.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"[object NaiveDict]"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dict = <span class="keyword">new</span> NaiveDict();</span><br><span class="line"></span><br><span class="line">dict.alice = <span class="number">34</span>;</span><br><span class="line">dict.bob = <span class="number">24</span>;</span><br><span class="line">dict.chris = <span class="number">62</span>;</span><br><span class="line"></span><br><span class="line">dict.count(); <span class="comment">// 5, 算上了count和toString</span></span><br></pre></td></tr></table></figure></p>
<p>类似的错误比如使用数组表示字典, 当有别的库扩展了数组的原型的时候, 也会出现上述问题. 这被称为<strong>原型污染</strong></p>
<p>当使用直接的对象字面量时, 只会受到<code>Object.prototype</code>的影响.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dict = &#123;&#125;;</span><br><span class="line">dict.alice = <span class="number">34</span>;</span><br><span class="line">dict.bobo = <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> names = [];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> dict)&#123;</span><br><span class="line">    names.push(name);</span><br><span class="line">&#125;</span><br><span class="line">names; <span class="comment">// ["alice", "bob"]</span></span><br></pre></td></tr></table></figure></p>
<ol>
<li><strong>使用对象字面量构造轻量级字典</strong></li>
<li><strong>轻量级字典应该是Object.prototype的直接子类, 这样for in循环时能避免原型污染</strong></li>
</ol>
<h3 id="44-使用null原型防止原型污染"><a href="#44-使用null原型防止原型污染" class="headerlink" title="44. 使用null原型防止原型污染"></a>44. 使用null原型防止原型污染</h3><p>防止原型污染最简单的方式之一就是一开始就不使用原型. 但ES5之前, 没有标准的方式创建一个空原型的新对象.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">C</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">C.prototype = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 但实例化该构造函数仍然得到Object的实例</span></span><br><span class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> C();</span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(o) === <span class="literal">null</span>; <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(o) === <span class="built_in">Object</span>.prototype; <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p>
<p>ES5提供了标准的方法来创建一个没有原型的对象, <code>Object.create</code>函数能使用一个用户指定的原型链和一个属性表示符动态的构造对象.属性描述符描述了新对象属性的值及特性.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(o) === <span class="literal">null</span>; <span class="comment">// true // PS: 在chrome下为false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 若环境不支持Object.create, 则可以使用__proto__属性</span></span><br><span class="line"><span class="keyword">var</span> x = &#123;<span class="attr">__proto__</span>: <span class="literal">null</span>&#125;;</span><br><span class="line">x <span class="keyword">instanceof</span> <span class="built_in">Object</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure></p>
<ol>
<li><strong>在ES5中, 使用Object.create(null)创建自由原型的空对象是不太容易被污染的</strong></li>
<li><strong>在一些老环境中, 考虑使用{<code>__proto__</code>: null}</strong></li>
<li><strong><code>__proto__</code>既不标准,也不是完全可移植的, 可能在未来被移除</strong></li>
<li><strong>绝不要使用<code>__proto__</code>作为字典中的key, 一些环境下将其作为特殊的属性</strong></li>
</ol>
<h3 id="45-使用hasOwnProperty方法以避免原型污染"><a href="#45-使用hasOwnProperty方法以避免原型污染" class="headerlink" title="45. 使用hasOwnProperty方法以避免原型污染"></a>45. 使用hasOwnProperty方法以避免原型污染</h3><p>即使是一个空对象字面量,也继承了Object.prototype的大量属性. 因为JS的对象操作总是以继承的方式工作.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dict = &#123;&#125;;</span><br><span class="line"><span class="string">"alice"</span> <span class="keyword">in</span> dict; <span class="comment">// false</span></span><br><span class="line"><span class="string">"toString"</span> <span class="keyword">in</span> dict; <span class="comment">// true</span></span><br><span class="line"><span class="string">"vauleOf"</span> <span class="keyword">in</span> dict; <span class="comment">// true // PS: chrome下为false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//可以使用hasOwnProperty方法, 它能避免原型污染</span></span><br><span class="line">dict.hasOwnProperty(<span class="string">"alice"</span>); <span class="comment">// false</span></span><br><span class="line">dict.hasOwnProperty(<span class="string">"toString"</span>); <span class="comment">// false</span></span><br><span class="line">dict.hasOwnProperty(<span class="string">"valueOf"</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure></p>
<p>为了避免字典中存储了一个同为”hasOwnProperty”名称的属性. 可以采用call方法, 而不用本身的hasOwnProperty方法<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hasOwn = <span class="built_in">Object</span>.prototype.hasOwnProperty;</span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="keyword">var</span> hasOwn = &#123;&#125;.hasOwnProperty;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用时用call绑定任意对象, 这样不管接收者的hasOwnProperty方法是否被覆盖,该方法都能正常工作</span></span><br><span class="line">hasOwn.call(dict,<span class="string">"alice"</span>);</span><br></pre></td></tr></table></figure></p>
<p>最后, 将这种方法抽象到Dict类的构造函数中, 避免每次都使用call显示绑定实例对象<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dict</span>(<span class="params">elements</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.elements = elements || &#123;&#125;; <span class="comment">// 这样允许传入一个可选的elements参数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Dict.prototype.has = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;.hasOwnProperty.call(<span class="keyword">this</span>.elements, key);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Dict.prototype.get = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 只返回自身的属性</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.has(key) </span><br><span class="line">        ? <span class="keyword">this</span>.elements[key]</span><br><span class="line">        : <span class="literal">undefined</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Dict.prototype.set = <span class="function"><span class="keyword">function</span>(<span class="params">key, val</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.elements[key] = val;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Dict.prototype.remove = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">delete</span> <span class="keyword">this</span>.elements[key];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用如下</span></span><br><span class="line"><span class="keyword">var</span> dict = <span class="keyword">new</span> Dict(&#123;</span><br><span class="line">    alice: <span class="number">34</span>,</span><br><span class="line">    bob: <span class="number">24</span>,</span><br><span class="line">    chris: <span class="number">62</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dict.has(<span class="string">'alice'</span>); <span class="comment">// true</span></span><br><span class="line">dict.get(<span class="string">'bob'</span>); <span class="comment">// 24</span></span><br><span class="line">dict.has(<span class="string">'valueOf'</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure></p>
<p>但上述Dict类没有考虑到<code>__proto__</code>属性的问题, 所以还不是最完美的. 为了达到最大的可移植性和安全性. 需要为每一个Dict类的方法都添加对<code>__proto__</code>属性的检查.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dict</span>(<span class="params">elements</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.elements = elements || &#123;&#125;; <span class="comment">// 这样允许传入一个可选的elements参数</span></span><br><span class="line">    <span class="keyword">this</span>.hasSpecialProto = <span class="literal">false</span>; <span class="comment">// 标识是否存在__proto__属性</span></span><br><span class="line">    <span class="keyword">this</span>.specialProto = <span class="literal">undefined</span>; <span class="comment">// __proto__属性的引用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Dict.prototype.has = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(key === <span class="string">"__proto__"</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.hasSpecialProto;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;.hasOwnProperty.call(<span class="keyword">this</span>.elements, key);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Dict.prototype.get = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;    </span><br><span class="line">    <span class="keyword">if</span>(key === <span class="string">"__proto__"</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.specialProto;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 只返回自身的属性</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.has(key) </span><br><span class="line">        ? <span class="keyword">this</span>.elements[key]</span><br><span class="line">        : <span class="literal">undefined</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Dict.prototype.set = <span class="function"><span class="keyword">function</span>(<span class="params">key, val</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(key === <span class="string">"__proto__"</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>.hasSpecialProto = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.specialProto = val;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.elements[key] = val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Dict.prototype.remove = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(key === <span class="string">"__proto__"</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>.hasSpecialProto = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.specialProto = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> <span class="keyword">this</span>.elements[key];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用如下</span></span><br><span class="line"><span class="keyword">var</span> dict = <span class="keyword">new</span> Dict();</span><br><span class="line"></span><br><span class="line">dict.has(<span class="string">'__proto__'</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure></p>
<ol>
<li><strong>使用hasOwnProperty方法避免原型污染</strong></li>
<li><strong>使用词法作用域和call方法避免覆盖hasOwnProperty方法</strong></li>
<li><strong>考虑在封装hasOwnProperty的类中实现字典操作</strong></li>
<li><strong>使用字典类避免将<code>__proto__</code>作为key使用</strong></li>
</ol>
<h3 id="46-使用数组而不是使用字典来存储有序集合"><a href="#46-使用数组而不是使用字典来存储有序集合" class="headerlink" title="46. 使用数组而不是使用字典来存储有序集合"></a>46. 使用数组而不是使用字典来存储有序集合</h3><p>因为使用<code>for in</code>循环来枚举对象属性应该与顺序无关,而ES标准也没有对枚举对象属性的顺序做出定义. </p>
<p>所以一定确保枚举对象属性的时候, 操作的行为和顺序无关.</p>
<h3 id="47-绝不要在Object-prototype中增加可枚举的属性"><a href="#47-绝不要在Object-prototype中增加可枚举的属性" class="headerlink" title="47. 绝不要在Object.prototype中增加可枚举的属性"></a>47. 绝不要在Object.prototype中增加可枚举的属性</h3><p>通过以上的一些例子,我们了解到,在<code>Object.prototype</code>中添加的方法或者属性能被子类用<code>for in</code>循环枚举出来.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.allKeys = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> result = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> <span class="keyword">this</span>)&#123;</span><br><span class="line">            result.push(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span>&#125;).allKeys(); <span class="comment">// ["a","b","c","allKeys"]</span></span><br></pre></td></tr></table></figure></p>
<p>解决的方法是,使用一个命名函数,而不是在原型对象上添加共享的方法.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">allKeys</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> result = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj)&#123;</span><br><span class="line">            result.push(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ES5提供了一种友好的在<code>Object.prototype</code>中添加属性的机制.使用<code>defineProperty</code>方法. 可以定义一个对象的属性并指定该属性的元数据.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.defineProperty(<span class="built_in">Object</span>.prototype, <span class="string">"allkeys"</span>, &#123;</span><br><span class="line">    value: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> result = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> <span class="keyword">this</span>)&#123;</span><br><span class="line">            result.push(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;,</span><br><span class="line">    writable: <span class="literal">true</span>,</span><br><span class="line">    enumerable: <span class="literal">false</span>,</span><br><span class="line">    configurable: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<ol>
<li><strong>避免在Object.prototype中添加属性</strong></li>
<li><strong>考虑编写一个函数代替Object.prototype方法</strong></li>
<li><strong>若确定要在Object.prototype中添加属性, 用ES5的defineProperty方法将他们定义为不可枚举的属性</strong></li>
</ol>
<h3 id="48-避免在枚举期间修改对象"><a href="#48-避免在枚举期间修改对象" class="headerlink" title="48. 避免在枚举期间修改对象"></a>48. 避免在枚举期间修改对象</h3><p>一个例子说明问题, 社交网络有一组成员, 每一个成员有一个存储其朋友信息的列表.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Member</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.friends = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Member(<span class="string">'alice'</span>),</span><br><span class="line">    b = <span class="keyword">new</span> Member(<span class="string">'bob'</span>),</span><br><span class="line">    c = <span class="keyword">new</span> Member(<span class="string">'carol'</span>),</span><br><span class="line">    d = <span class="keyword">new</span> Member(<span class="string">'dieter'</span>),</span><br><span class="line">    e = <span class="keyword">new</span> Member(<span class="string">'eli'</span>),</span><br><span class="line">    f = <span class="keyword">new</span> Member(<span class="string">'fatima'</span>);</span><br><span class="line"></span><br><span class="line">a.friends.push(b);</span><br><span class="line">b.friends.push(c);</span><br><span class="line">c.friends.push(e);</span><br><span class="line">d.friends.push(b);</span><br><span class="line">e.friends.push(d, f);</span><br></pre></td></tr></table></figure></p>
<p><img src="1.png" alt="社交网络图"></p>
<p>搜索一个社交网络需要遍历该社交网络, 通过<code>workset</code>实现. 原理为, 以单个根节点开始, 添加发现的节点, 移除访问过的节点. 下面的用<code>for in</code>循环实现该方法.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Member.prototype.inNetwork = <span class="function"><span class="keyword">function</span>(<span class="params">other</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> visited = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> workset = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    workset[<span class="keyword">this</span>.name] = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> workset)&#123;</span><br><span class="line">        <span class="keyword">var</span> member = workset[name];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">delete</span> workset[name];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(name <span class="keyword">in</span> visited)&#123; <span class="comment">// 无法找到</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        visited[name] = member;</span><br><span class="line">        <span class="keyword">if</span>(member === other)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        member.friends.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">friend</span>)</span>&#123;</span><br><span class="line">            workset[friend.name] = friend;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 问题是, 这段代码无法正常运行, 有bug</span></span><br><span class="line">a.inNetwork(f); <span class="comment">// false</span></span><br></pre></td></tr></table></figure></p>
<p>问题根源为ES规定: 若被枚举对象在枚举期间添加了新的属性, 那么枚举期间并不能保障新添加的属性能够被访问.即</p>
<p>若我们修改了被枚举对象, 则不能确保<code>for in</code>循环的行为是预期的了.</p>
<p>尝试自己控制循环而不使用内置的forEach，同时使用自己的字典抽象以避免原型污染，实现方式为将字典放置在WorkSet类中来追踪当前集合中的元素数量<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WorkSet</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.entries = <span class="keyword">new</span> Dict();</span><br><span class="line">    <span class="keyword">this</span>.count = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">WorkSet.prototype.isEmpty = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.count === <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">WorkSet.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">key, val</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.entries.has(key))&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.entries.set(set, key);</span><br><span class="line">    <span class="keyword">this</span>.count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">WorkSet.prototype.get = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.entries.get(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">WorkSet.prototype.remove = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">this</span>.entries.has(key))&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.entries.remove(key);</span><br><span class="line">    <span class="keyword">this</span>.count--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>为了提取集合中的某个元素，需要给Dict类添加一个新的方法<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Dict.prototype.pick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> <span class="keyword">this</span>.elements)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.has(key))&#123;</span><br><span class="line">            <span class="keyword">return</span> key;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"empty dictionary"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">WorkSet.prototype.pick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.entries.pick();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在可以使用while循环类实现inNetwork方法，每次选择任意元素并从工作集中删除。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Member.prototype.inNetwork = <span class="function"><span class="keyword">function</span>(<span class="params">other</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> visited = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> workset = <span class="keyword">new</span> WorkSet();</span><br><span class="line">    workset.add(<span class="keyword">this</span>.name, <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">while</span>(!workset.isEmpty())&#123;</span><br><span class="line">        <span class="keyword">var</span> name = workset.pick();</span><br><span class="line">        <span class="keyword">var</span> member = workset.get(name);</span><br><span class="line">        workset.remove(name);</span><br><span class="line">        <span class="keyword">if</span>(name <span class="keyword">in</span> visited)&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        visited[name] = member;</span><br><span class="line">        <span class="keyword">if</span>(member === other)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        member.friends.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">friend</span>)</span>&#123;</span><br><span class="line">            workset.add(friend.name, friend);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>pick方法是不确定的，因为<code>for in</code>循环的枚举顺序的不确定，所以可以考虑确定的工作集算法，将工作集改为列表，存储在数组中，inNetwork方法总是用相同的顺序遍历图<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Member.prototype.inNetwork = <span class="function"><span class="keyword">function</span>(<span class="params">other</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> visited = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> worklist = [<span class="keyword">this</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(worklist.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> member = worklist.pop();</span><br><span class="line">        <span class="keyword">if</span>(member.name <span class="keyword">in</span> visited)&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        visited[member.name] = member;</span><br><span class="line">        <span class="keyword">if</span>(member === other)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        member.friends.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">friend</span>)</span>&#123;</span><br><span class="line">            worklist.push(friend);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<ol>
<li><strong>当使用for in循环枚举一个对象的属性时，要确保不修改该对象</strong></li>
<li><strong>当迭代一个对象时，若该对象的内容可能会在循环期间被改变，应该使用while循环或for循环代替for in循环</strong></li>
<li><strong>为了在不断变化的数据结构中能够预测枚举，考虑使用一个有序的数据结构，如数组，而不是使用字典对象</strong></li>
</ol>
<h3 id="49-数组迭代优先选择for循环-而不是for-in循环"><a href="#49-数组迭代优先选择for循环-而不是for-in循环" class="headerlink" title="49. 数组迭代优先选择for循环,而不是for in循环"></a>49. 数组迭代优先选择for循环,而不是for in循环</h3><p>下面这段代码mean的输出值为多少?<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scores = [<span class="number">98</span>, <span class="number">74</span>, <span class="number">85</span>, <span class="number">77</span>, <span class="number">93</span>, <span class="number">100</span>, <span class="number">89</span>];</span><br><span class="line"><span class="keyword">var</span> total = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> score <span class="keyword">in</span> scores)&#123;</span><br><span class="line">    total += score;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> mean = total / scores.length;</span><br><span class="line">mean; <span class="comment">// ?</span></span><br></pre></td></tr></table></figure></p>
<p>答案并不是88(正常的逻辑下), 也不是21(for in循环枚举的是key, 这里的key为 0, 1, 2, 3, 4, 5, 6). </p>
<p><em>而是17636.571428571428, 因为字符串的<code>+=</code>操作,total变量最后的值为<code>&quot;00123456&quot;</code>, 而这里是将一个字符串按照8进制转化为十进制之后,再除以7得到的17636.571428571428</em><br><strong>经chrome测试，结果为<code>NaN</code>，total变量最后的值为<code>&quot;00123456remove&quot;</code></strong></p>
<p>正确的方法(得到88的方法)为使用for循环.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scores = [<span class="number">98</span>, <span class="number">74</span>, <span class="number">85</span>, <span class="number">77</span>, <span class="number">93</span>, <span class="number">100</span>, <span class="number">89</span>];</span><br><span class="line"><span class="keyword">var</span> total = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>, n = scores.length; i &lt; n; ++i)&#123;</span><br><span class="line">    total += scores[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> mean = total / scores.length;</span><br><span class="line">mean; <span class="comment">// 88</span></span><br></pre></td></tr></table></figure></p>
<p>注意变量<code>n</code>的使用, 若循环体不修改数组, 则每次迭代中, 循环都会简单的重新计算数组的长度.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; score.length; ++i)&#123;...&#125;</span><br></pre></td></tr></table></figure></p>
<p>同时, 在循环一开始就计算数组的长度还有几个好处:</p>
<ol>
<li>即使是优化的JS编译器,可能有时也很难保证避免重新计算scores.length是安全的.</li>
<li><p>能给阅读代码的人一个信息, 循环的终止条件是简单且确定的.</p>
</li>
<li><p><strong>迭代数组的索引属性应当总是使用for循环而不是for in循环</strong></p>
</li>
<li><strong>考虑在循环之前将数组的长度存储在一个局部变量中以避免重新计算数组长度</strong></li>
</ol>
<h3 id="50-迭代方法优于循环"><a href="#50-迭代方法优于循环" class="headerlink" title="50. 迭代方法优于循环"></a>50. 迭代方法优于循环</h3><p>编程中容易在确定循环终止条件时引入的一些简单错误.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= n; ++i)&#123;...&#125; <span class="comment">// 例外的结尾循环</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; n; ++i)&#123;...&#125; <span class="comment">// 跳过了第一次循环</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = n; i &gt;= <span class="number">0</span>; --i)&#123;...&#125; <span class="comment">// 例外的初始循环</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = n<span class="number">-1</span>; i &gt; <span class="number">0</span>; --i)&#123;...&#125; <span class="comment">// 跳过了最后一次循环</span></span><br></pre></td></tr></table></figure></p>
<p>ES5中,可以使用一些便利的方法,比如<code>forEach</code>, 能消除终止条件和任何数组索引.<br>具体看: <a href="https://shimo.im/doc/VXqv2bxTlOUiJJqO/" target="_blank" rel="noopener">你还在用for循环大法麽？</a></p>
<p>上面的都是ES5中的默认方法, 我们完全可以定义自己的迭代抽象方法, </p>
<p>一般将这些方法称为谓词, 重复地对数组的每个元素应用<strong>回调的谓词</strong>.</p>
<p>比如提取满足谓词(下面细说什么叫谓词)的数组的前几个元素.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">takeWhile</span>(<span class="params">a, pred</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>, n = a.length; i &lt; n; ++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!pred(a[i], i))&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        result[i] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> prefix = takeWhile([<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">32</span>], <span class="function"><span class="keyword">function</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n &lt; <span class="number">10</span>;</span><br><span class="line">&#125;); <span class="comment">// [1, 2, 4, 8]</span></span><br></pre></td></tr></table></figure></p>
<p><code>takeWhile</code>方法将数组所以<code>i</code>赋给了<code>pred</code>, 我们可以选择使用或者忽略该参数. 在标准库中所以的迭代方法, 都将数组的所以传递给用户自定义的函数.</p>
<p>循环只有一点优于迭代函数, 那就是前者有控制流程操作, 如<code>break</code>和<code>continue</code>. 而后者,只有some和every方法可以提前终止循环, 而forEach是无法自动提前结束的.</p>
<p>some和every是短路循环(short-circuiting), 若对some方法回调一旦产生真值,则直接返回, 不会执行其余元素. every是产生假值则立即返回.</p>
<p>这种行为可以在这些方法在实现forEach提前终止循环的变种时使用.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">takeWhile</span>(<span class="params">a, pred</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = [];</span><br><span class="line">    a.every(<span class="function"><span class="keyword">function</span>(<span class="params">x, i</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!pred(x))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// break</span></span><br><span class="line">        &#125;</span><br><span class="line">        result[i] = x;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// continue</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol>
<li><strong>使用迭代方法(如Array.prototype.forEach 和 Array.prototype.map) 替换for循环使得代码更可读, 并且避免了重复循环控制逻辑</strong></li>
<li><strong>使用自定义的迭代函数来抽象未被标准库支持的常见循环模式</strong></li>
<li><strong>在需要提前终止循环的情况下, 仍然推荐使用传统的循环, some和every方法可以用于提前退出</strong></li>
</ol>
<h3 id="51-在类数组对象上复用通用的数组方法"><a href="#51-在类数组对象上复用通用的数组方法" class="headerlink" title="51. 在类数组对象上复用通用的数组方法"></a>51. 在类数组对象上复用通用的数组方法</h3><p>Array.prototype中的标准方法被设计为其他对象可复用的方法, 即使这些对象并没有继承Array. 比如函数的arguments对象.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">highlight</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    [].forEach.call(<span class="built_in">arguments</span>, <span class="function"><span class="keyword">function</span>(<span class="params">widget</span>)</span>&#123;</span><br><span class="line">        widget.setBackground(<span class="string">'yellow'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>forEach方法是一个Function对象, 它继承了Function.prototype中的call方法.</p>
<p>与arguments对象一样, DOM中的NodeList类是web页面中的节点, 使用document.getElementsByTagName操作会返回一个NodeList作为结果.</p>
<p><strong>关键为怎么使一个对象”看起来像数组”?</strong> 数组对象的基本构成有两个简单的规则:</p>
<ol>
<li>具有一个范围在0到2^32 - 1的整数length属性. </li>
<li>length属性大于该对象的最大索引, 所以是一个范围在0到2^32 - 2的整数, 它的字符串表示的是该对象的一个key.</li>
</ol>
<p>只要满足上述2点,即使是一个对象字面量也可以改造为一个类数组对象<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arraylike = &#123;<span class="number">0</span>:<span class="string">'a'</span>, <span class="number">1</span>:<span class="string">'b'</span>, <span class="number">2</span>:<span class="string">'c'</span>, <span class="attr">length</span>:<span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> result = <span class="built_in">Array</span>.prototype.map.call(arraylike, <span class="function"><span class="keyword">function</span>(<span class="params">s</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s.toUpperCase();</span><br><span class="line">&#125;); <span class="comment">// ["A","B","C"]</span></span><br></pre></td></tr></table></figure></p>
<p>字符串可当做不可变的数组, 因此Array.prototype中的方法操作字符串时并不会修改原始数组.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="built_in">Array</span>.prototype.map.call(<span class="string">"abc"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">s</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s.toUpperCase();</span><br><span class="line">&#125;); <span class="comment">// ["A", "B", "C"]</span></span><br></pre></td></tr></table></figure></p>
<p>只有一个Array方法不是完全通用的,数组连接方法<code>concat</code>, 该方法可以由任意的类数组接收者调用. 它会检查参数的[[class]]属性.</p>
<p>若参数是一个真实的数组, 那么concat会将该数组的内容连接起来作为结果; 否则, 参数将以一个单一的元素来连接.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不能简单的连接一个以arguments对象作为内容的数组</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">namesColumn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">"Names"</span>].concat(<span class="built_in">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">namesColumn(<span class="string">"alice"</span>, <span class="string">"bob"</span>, <span class="string">"chris"</span>); <span class="comment">// ["Names",&#123;0: "alice", 1:"bob", 2:"chris"&#125;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 为了使concat将一个类数组对象作为真正的数组, 我们需要自己转换该数组</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">namesColumn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">"Names"</span>].concat([].slice.call(<span class="built_in">arguments</span>));</span><br><span class="line">&#125;</span><br><span class="line">namesColumn(<span class="string">"alice"</span>, <span class="string">"bob"</span>, <span class="string">"chris"</span>); <span class="comment">// ["Names", "alice", "bob", "chris"]</span></span><br></pre></td></tr></table></figure></p>
<p>目前, 模拟JS数组的所有行为比较困难, 主要由于数组行为的两个方面.</p>
<ol>
<li>将length属性值设为小于n的值会自动删除索引值大于或等于n的所有属性</li>
<li>增加一个索引值为n(大于或等于length属性值)的属性会自动的设置length属性为n+1</li>
</ol>
<p>第二条规则尤其难以完成, 因为它需要监控索引属性的增加以自动地更新length属性.</p>
<ol>
<li><strong>对于类数组对象, 通过提取方法对象并使用其call方法来复用通用的Array方法</strong></li>
<li><strong>任意一个具有索引属性和恰当length属性的对象都可以使用通用Array方法</strong></li>
</ol>
<h3 id="52-数组字面量优于数组构造函数"><a href="#52-数组字面量优于数组构造函数" class="headerlink" title="52. 数组字面量优于数组构造函数"></a>52. 数组字面量优于数组构造函数</h3><p>JS的优雅和方便可以归功于常见构造块的简明的字面量语法(对象, 函数, 数组). 也可以使用数组构造函数代替<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br></pre></td></tr></table></figure></p>
<p>使用数组构造函数来代替数组字面量会有一些微小的差别.</p>
<p>比如,无法确定是否修改过全局的Array变量.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span> = <span class="built_in">String</span>;</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>); <span class="comment">// new String(1);</span></span><br></pre></td></tr></table></figure></p>
<p>同时还有一个特殊的情况,使用单数字参数来调用Array构造函数, 并不是构造只有一个元素的数组, 而是构造了一个没有元素的数组, 但其长度属性为给定的参数. </p>
<p><code>[&quot;hello&quot;]</code> 和 <code>new Array(&quot;hello&quot;)</code>行为相同, 但是 <code>[17]</code> 和 <code>new Array(17)</code>的行为却完全不同.</p>
<ol>
<li><strong>若数组构造函数的唯一个参数是数组则数组的构造函数行为是不同的</strong></li>
<li><strong>使用数组字面量替代数组构造函数</strong></li>
</ol>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2017/03/06/effective-javascript6/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            Newer
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/03/01/mixed/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>
    <!-- modified By KING 2017.11.16 -->
    <!-- Sidebar Avatar
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="KING's avatar">
    </div> -->

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        xmoyking@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="https://github.com/xmoyKing/xmoyKing.github.io" target="_blank" title="Star Me on GitHub">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">star</i>
                        
                        Star Me on GitHub
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                Home
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    Archives
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/12/">December 2017<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">November 2017<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">October 2017<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">September 2017<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">August 2017<span class="sidebar_archives-count">13</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">July 2017<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">June 2017<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">May 2017<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">April 2017<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">March 2017<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">February 2017<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">January 2017<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">November 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">October 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">September 2016<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">August 2016<span class="sidebar_archives-count">20</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                Categories
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Angular/">Angular<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/categories/Nodejs/">Nodejs<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/categories/TypeScript/">TypeScript<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/angularjs/">angularjs<span class="sidebar_archives-count">50</span></a></li><li><a class="sidebar_archives-link" href="/categories/css/">css<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/categories/express/">express<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/interview/">interview<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/it/">it<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/java/">java<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/js/">js<span class="sidebar_archives-count">70</span></a></li><li><a class="sidebar_archives-link" href="/categories/linux/">linux<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/mixed/">mixed<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/categories/mongodb/">mongodb<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/promise/">promise<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/categories/python/">python<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="Tags">
                
                    <i class="material-icons sidebar-material-icons">bookmark</i>
                
                Tags
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
    
        <li>
            <a href="/about/links.html" title="Links">
                
                    <i class="material-icons sidebar-material-icons">polymer</i>
                
                Links
            </a>
        </li>
        
    
        <li>
            <a href="http://www.filmboard.cn" title="Works">
                
                    <i class="material-icons sidebar-material-icons">code</i>
                
                Works
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                Number of articles
                <span class="sidebar-badge">189</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    
        <a href="https://plus.google.com/114920706759690760782" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    
        <a href="http://weibo.com/p/1005052419772155" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-weibo">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="http://github.com/xmoyking" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>KING · NOTE
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/lazyload.min.js", true)</script>



    <script>lsloader.load("js_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/js.min.js", true)</script>



    <script>lsloader.load("np_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/nprogress.js", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
